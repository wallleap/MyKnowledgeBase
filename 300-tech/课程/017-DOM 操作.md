---
title: 017-DOM æŸ¥è¯¢åˆ›å»º
date: 2023-03-16 14:39
updated: 2023-03-19 22:34
cover: //cdn.wallleap.cn/img/post/1.jpg
image-auto-upload: true
author: Luwang
comments: true
aliases:
  - 017-DOM æ“ä½œ
rating: 1
tags:
  - JavaScript
category: web
keywords:
  - å…³é”®è¯1
  - å…³é”®è¯2
  - å…³é”®è¯3
description: æ–‡ç« æè¿°
source: null
url: //myblog.wallleap.cn/post/1
---

## JS åŒ…å«ä»€ä¹ˆ

åœ¨æµè§ˆå™¨å®¿ä¸»ä¸­

- EcmaScriptï¼ˆES3ã€ES5ã€ES6ï¼‰
	- Object
	- Array
	- Function
	- â€¦â€¦ä¸ä¾æ‰˜äºå®¿ä¸»ç¯å¢ƒ
- DOM
	- document
	- Event
	- â€¦â€¦
- BOM
	- navigator
	- screen
	- location
	- history
	- XMLHttpRequest

## DOM æ˜¯ä»€ä¹ˆ

æ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼ˆDocument Object Modelï¼ŒDOMï¼‰æ˜¯ HTML çš„ç¼–ç¨‹æ¥å£ã€‚ç”¨å¯¹è±¡å’Œ HTML ç»“æ„ä¸€ä¸€æ˜ å°„ï¼Œé€šè¿‡ä¿®æ”¹å¯¹è±¡è¾¾åˆ°ä¿®æ”¹ HTML èŠ‚ç‚¹çš„ç›®çš„ã€‚

![](https://cdn.wallleap.cn/img/pic/illustration/202303161445562.png)

## ç†Ÿç»ƒæŒæ¡è¿™äº›

- å…ƒç´ çš„è·å–ã€éå†
- äº‹ä»¶ç»‘å®š
- class çš„å¢åˆ æ”¹æŸ¥
- å…ƒç´ çš„å¢åˆ æ”¹æŸ¥
- å±æ€§çš„å¢åˆ æ”¹æŸ¥
- style çš„æ“ä½œ

## è·å–å…ƒç´ 

```js
/* ES 5 å†™æ³•ï¼Œæ¨èä½¿ç”¨ */
// è·å–çš„æ˜¯ä¸€ä¸ª El
document.querySelector('el') // å‚æ•°æ˜¯é€‰æ‹©å™¨å­—ç¬¦ä¸²
// è·å–çš„æ˜¯ä¸€ä¸ª NodeList ç±»æ•°ç»„å¯¹è±¡ï¼ŒåŒ…å«å¤šä¸ª Element
document.querySelectorAll('el')
/* ES 3 å†™æ³•ï¼Œå·²ç»è¿‡æ—¶ï¼Œä¸æ¨è */
// è·å–çš„æ˜¯ä¸€ä¸ª Elï¼Œä¼ å…¥çš„æ˜¯ id å­—ç¬¦ä¸²
document.getElementById('id')
// è·å–çš„æ˜¯ä¸€ä¸ª HTMLCollection ç±»æ•°ç»„å¯¹è±¡ï¼Œä¼ å…¥ç±»å
document.getElementsByClassName('class')
// è·å–çš„æ˜¯ä¸€ä¸ª HTMLCollection ç±»æ•°ç»„å¯¹è±¡ï¼Œä¼ å…¥æ ‡ç­¾å
document.getElementsByTagName('el')
// è·å–çš„æ˜¯ä¸€ä¸ª NodeList ç±»æ•°ç»„å¯¹è±¡ï¼Œä¼ å…¥ name å±æ€§å€¼
document.getElementsByName('username')
```

âš ï¸ éœ€è¦æ³¨æ„ï¼š

- `querySelector` çš„å‚æ•°æ˜¯ä¸€ä¸ªä»»æ„åˆæ³•çš„ CSS3 é€‰æ‹©å™¨
- `querySelectorAll` å¾—åˆ°çš„æ˜¯ä¸€ä¸ªç±»æ•°ç»„å¯¹è±¡ï¼Œéœ€è¦éå†æ‰èƒ½æ“ä½œ
- NodeList å’Œ HTTPCollection çš„å·®å¼‚æ˜¯å‰è€…æœ‰ `forEach` æ–¹æ³•

ğŸŒ° éå† NodeList å’Œ HTMLCollection

```js
// NodeList å¯ä»¥ç›´æ¥ä½¿ç”¨ forEach éå†
document.querySelectorAll('.box').forEach(node => {
  console.log(node.className)
})
// HTTPCollection éœ€è¦è½¬æ¢ä¸ºæ•°ç»„æ‰èƒ½ç”¨ forEach
Array.from(document.getElementsByClassName('box')).forEach(node => {
  console.log(node.className)
})
;[...document.getElementsByClassName('box')].forEach(node => {})
// éƒ½å¯ä»¥ä½¿ç”¨ for-of å’Œå¸¸è§„å¾ªç¯
for(let node of document.getElementsByClassName('box')) {
  console.log(node.className)
}
```

ğŸˆ ä½¿ç”¨æŠ€å·§

ä¸ä»…ä»…åªæ˜¯ document å¯ä»¥ä½¿ç”¨ querySelectorï¼Œå…¶ä»– DOM å…ƒç´ ä¹Ÿéƒ½å¯ä»¥ä½¿ç”¨ï¼ˆDOM å…ƒç´ å˜é‡å‘½åå¯ä»¥ä»¥ `$` å¼€å¤´ï¼Œæµè§ˆå™¨ä¸­ `$0` æ˜¯å½“å‰é€‰ä¸­çš„å…ƒç´ ï¼‰

```js
const $box = document.querySelector('.box')
const $node = $box.querySelector('.child')  // ç¬¬ä¸€ä¸ªï¼Œæ˜¯ä¸ªå…ƒç´ 
const $$nodes = $box.querySelectorAll('.child')  // æ‰€æœ‰çš„ï¼Œæ˜¯ NodeList ç±»æ•°ç»„å¯¹è±¡
```

æŠŠ `document.querySelector` å°è£…æˆå‡½æ•°ï¼Œä½¿ç”¨èµ·æ¥ä¼šæ›´åŠ æ–¹ä¾¿

```js
const $ = el => document.querySelector(el)
const $$ = el => document.querySelectorAll(el)
console.log($('.box'))
console.log($$('.child'))
```

## DOM å…ƒç´ å±æ€§

å¸¸è§å±æ€§

- `node.nodeName`  å…ƒç´ æ ‡ç­¾åï¼Œç±»ä¼¼çš„è¿˜æœ‰ `tagName`
- `node.className`  ç±»å
- `node.id`  å…ƒç´  id
- `node.nodeType`  å…ƒç´ ç±»å‹

å…³ç³»éå†

- `node.children`  å­å…ƒç´ åˆ—è¡¨ï¼ˆHTMLCollectionï¼Œä¸åŒ…å«æ–‡æœ¬èŠ‚ç‚¹ï¼‰
- `node.childNodes`  å­å…ƒç´ åˆ—è¡¨ï¼ˆNodeListï¼ŒåŒ…å«æ–‡æœ¬èŠ‚ç‚¹ï¼‰
- `node.firstChild`  ç¬¬ä¸€ä¸ªå­å…ƒç´ 
- `node.lastChild`  æœ€åä¸€ä¸ªå­å…ƒç´ 
- `node.nextSibling`  ä¸‹ä¸€ä¸ªå…„å¼Ÿå…ƒç´ 
- `node.previousSibling`  ä¸Šä¸€ä¸ªå…„å¼Ÿå…ƒç´ 
- `node.parentNode`  çˆ¶å…ƒç´ 

å…¶ä»–

- `document.body` ç­‰åŒäº `document.querySelector('body')`
- `document.head` ç­‰åŒäº `document.querySelector('head')`
- `document.title` ç­‰åŒäº `document.querySelector('title').innerText`

## äº‹ä»¶ç»‘å®š

```js
/* ç»‘å®šå¹¶æ²¡æœ‰æ‰§è¡Œï¼Œç”¨æˆ·è§¦å‘æ‰æ‰§è¡Œ */
$node.onclick = function(e) { // onclick è¿™ä¸ªæ˜¯ç‚¹å‡»äº‹ä»¶
  console.log(this)  // this åœ¨è¿™é‡Œè¡¨ç¤º $node
}
// è¿˜å¯ä»¥è¿™æ ·å†™
$node.addEventListrnerï¼ˆ'click', function(e) { // äº‹ä»¶ç›‘å¬å™¨ ç›‘å¬ click ç‚¹å‡»äº‹ä»¶
  console.log(this)
})
```

## å…ƒç´ çš„å¢åˆ æ”¹æŸ¥

### DOM å…ƒç´ çš„åˆ›å»ºå’Œè¿½åŠ 

- `document.createElement('div')` åˆ›å»º DOM èŠ‚ç‚¹ï¼Œå‚æ•°æ˜¯æ ‡ç­¾å
	- åˆ›å»ºå¥½æ˜¯ä¸ªæ¸¸ç¦»çš„èŠ‚ç‚¹ï¼Œåœ¨å†…å­˜ä¸­ï¼Œä¸å‡ºç°åœ¨é¡µé¢ä¸Šï¼Œæ­é… append æ’å…¥åˆ°é¡µé¢ä¸­
- `document.createTextNode('wallleap')` åˆ›å»ºæ–‡æœ¬èŠ‚ç‚¹ï¼Œå‚æ•°æ˜¯å­—ç¬¦ä¸²
- `document.createDocumentFragment()`  åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿçš„ DOM ä½œä¸ºå®¹å™¨ï¼Œé¿å…é«˜é¢‘ DOM æ“ä½œï¼Œç†è®ºä¸Šç”¨äºæå‡æ’å…¥åˆ°é¡µé¢ä¸Šæ—¶çš„æ€§èƒ½
- `$parent.appendChild($child)`
	- æŠŠ `$child` èŠ‚ç‚¹æ”¾åˆ° `$parent` èŠ‚ç‚¹å†…éƒ¨çš„å°¾éƒ¨
	- `$child` åªèƒ½æ˜¯ DOM èŠ‚ç‚¹ï¼Œä¸èƒ½æ˜¯å­—ç¬¦ä¸²
	- è¯¥æ–¹æ³•æœ‰äº›è€æ—§ï¼Œæ¨èç”¨ `$parent.append()` æ›¿ä»£
- `$parent.append()` åœ¨ `$parent` å†…éƒ¨å°¾éƒ¨è¿½åŠ  DOM èŠ‚ç‚¹æˆ–å­—ç¬¦ä¸²
- `$parent.prepend()` åœ¨ `$parent` å†…éƒ¨å¼€å¤´è¿½åŠ  DOM èŠ‚ç‚¹æˆ–å­—ç¬¦ä¸²
- `$node.innerHTML = '<div>xxx</div>'`
	- ä¿®æ”¹ `$node` å†…çš„ HTML å†…å®¹
	- ğŸš« **ç¦æ­¢**ä½¿ç”¨æ‹¼æ¥ HTML å­—ç¬¦ä¸²ï¼Œè®¾ç½® innerHTML çš„å½¢å¼åˆ›å»º DOMï¼Œæ˜“å¼•å‘ XSS æ¼æ´
- `$node.innerText='wallleap'` è®¾ç½®çš„å†…å®¹ä¼šä½œä¸º `$node` å†…çš„æ–‡æœ¬ï¼Œå®‰å…¨ã€å¯éšæ„ä½¿ç”¨

> æµ‹è¯• DOM æ“ä½œæ€§èƒ½

ä½¿ç”¨ `Date.now()` è·å–åˆ°å½“å‰çš„æ—¶é—´ï¼Œè®°å½•ä¹‹åï¼Œä½¿ç”¨æ‰§è¡Œå®Œæˆæ—¶çš„æ—¶é—´å‡å»è¿™ä¸ªè®°å½•çš„æ—¶é—´å°±æ˜¯æ‰§è¡Œæ‰€éœ€çš„æ—¶é—´

### DOM ç§»åŠ¨ã€æ›¿æ¢ã€åˆ é™¤

- `$parent.insertBefore($new, $reference)`  æŠŠ `$new` æ’å…¥åˆ° `$reference` å…ƒç´ å‰é¢
- `$parent.replaceChild($newChild, $oldChild)`  æŠŠ `$oldChild` æ›¿æ¢ä¸º `$newChild`
- `$parent.reomveChild($childNode)`  ä» `$parent` é‡Œåˆ é™¤ `$childNode`
- `$node.cloneNode(true)`  å…‹éš†ä¸€ä¸ªå…ƒç´ 
	- å‚æ•° true çš„æ—¶å€™ä¼šæ·±å¤åˆ¶ï¼Œä¹Ÿå°±æ˜¯ä¼šå¤åˆ¶å…ƒç´ åŠå…¶å­å…ƒç´ 
	- å‚æ•° false çš„æ—¶å€™åªå¤åˆ¶å…ƒç´ æœ¬èº«

ä¸‹é¢è¿™äº›æ˜¯æ–°çš„æ–¹æ³•ï¼Œä¸éœ€è¦å…ˆæ‰¾åˆ°ä»–ä»¬çš„çˆ¶çº§

- `$reference.before($node1, $node2, ...)`  åœ¨ `$reference` å…ƒç´ ä¹‹å‰æ’å…¥æ–°èŠ‚ç‚¹æˆ–æ–‡æœ¬
- `$reference.after($node1, $node2, ...)`  åœ¨ `$reference` å…ƒç´ ä¹‹åæ’å…¥æ–°èŠ‚ç‚¹æˆ–æ–‡æœ¬
- `$old.replaceWith($new)`  æŠŠ `$old` æ›¿æ¢ä¸ºæ–°èŠ‚ç‚¹æˆ–æ–‡æœ¬
- `$old.remove()`  æŠŠ `$old` èŠ‚ç‚¹åˆ é™¤

ğŸŒ° å° demoï¼šå†™ä¸€ä¸ªå‡½æ•° swapDomï¼Œäº¤æ¢ä¸¤ä¸ª DOM å…ƒç´ çš„ä½ç½®

## å±æ€§çš„å¢åˆ æ”¹æŸ¥

å¸¸è§ API

- `node.getAttribute('id')`  è·å–å±æ€§
- `node.setAttribute('data-id', '100')`  è®¾ç½®å±æ€§
- `node.reomveAttribute('checked')`  åˆ é™¤å±æ€§
- `document.createAttribute('checked')`  åˆ›å»ºå±æ€§èŠ‚ç‚¹
- `node.setAttributeNode(attrNode)`  è®¾ç½®å±æ€§èŠ‚ç‚¹

```js
let $link = document.createElement('a')
$link.setAttribute('href', 'https://wallleap.cn')
$link.setAttribute('target', '_blank')
$link.click()
```

## style æ“ä½œä¿®æ”¹æ ·å¼

- ä¿®æ”¹ `style` å±æ€§ç›´æ¥è®¾ç½®è¡Œå†…æ ·å¼
- ä½¿ç”¨ `getComputedStyle` è·å–å…ƒç´ è®¡ç®—åçš„æ ·å¼

```js
const $box = document.querySelector('.box')
$box.style.color = 'red'  // å­—ç¬¦ä¸²
$box.style.fontSize = '12px'  // å¯¹è±¡å±æ€§ä½¿ç”¨é©¼å³°å‘½å
let fontSize = getComputedStyle($box).fontSize
console.log(parseInt(fontSize))
```

å°½é‡ä¸è¦ç›´æ¥é€šè¿‡ JS ä¿®æ”¹ styleï¼Œè€Œæ˜¯å…ˆå®šä¹‰å¥½ CSS ç„¶åæ“ä½œ class æ¥ä¿®æ”¹æ ·å¼

ğŸŒ° ç‚¹å‡»æŒ‰é’®åŠ å¤§/å‡å°æ–‡å­—å¤§å°

## class API

- `node.classList.add('active')`  ç»™ node æ·»åŠ ä¸€ä¸ªå€¼ä¸º active çš„ class
- `node.classList.remove('active')`  åˆ é™¤ active è¿™ä¸ª class
- `node.classList.contains('active')`  åˆ¤æ–­ node æ˜¯å¦æ‹¥æœ‰ active è¿™ä¸ª class
- `node.classList.toggle('active')`  å¦‚æœæ²¡æœ‰ active è¿™ä¸ª class åˆ™æ·»åŠ ï¼Œæœ‰åˆ™åˆ é™¤
- `node.className`  è·å– classï¼Œè€æ–¹æ³•ï¼Œç”¨èµ·æ¥ä¸ä¸¥è°¨ï¼Œå°½é‡ä¸ç”¨

## åˆ©ç”¨ DOM å®ç°ä¸€äº›æ•ˆæœ ğŸŒ°

### å®ç° Tab é€‰é¡¹å¡

[é€‰é¡¹å¡ (jirengu.com)](http://js.jirengu.com/yahiforemu/)
