---
title: HTTP 理论
date: 2024-08-22T02:27:53+08:00
updated: 2024-08-22T02:28:17+08:00
dg-publish: false
---

## 目录

- [http1和 http2](#jump1)
- [http 和 https](#jump2)
- [HTTP与TCP的区别和联系](#jump3)
- [WebSocket原理](#jump4)
- [webSocket与HTTP的关系](#jump5)
- [浏览器输入地址后发生什么](#jump6)
- [HTTPS如何实现安全加密传输](#jump7)
- [报文结构](#jump8)
- [协议-分层](#jump9)

Queueing 时间说明

浏览器与同一个域名建立的 TCP 连接数是有限制的， chrome 设置的 6 个，如果说同一时间，发起的同一域名的请求超过了 6 个，这时候就需要排队了，也就是这个 Queueing 时间

http1

1. 无状态、无连接，对头阻塞、明文链接

HTTP1.1 中默认开启 Connection： keep-alive，一定程度上弥补了 HTTP1.0 每次请求都要创建连接的缺点

http2.0

1. 多路复用
2. 压缩头部，减少体积

http3.0

1. 使用 UDP

----

### <span id="jump6">浏览器输入地址后发生什么</span>

- 解析 URL
- DNS 解析、监测缓存
- 客户端与服务端建立 TCP 连接（三次握手）
- 请求与传输数据
- 进行数据渲染
- 解析 HTML、生成 DOM 树、解析 CSS 代码、将数据渲染到网页上

### <span id="jump7">HTTPS 如何实现安全加密传输</span>

- 客户端发起请求，链接到服务器 443 端口
- 服务端的证书（自己制作或向三方机构申请），自己制作的证书需要客户端验证通过 (用户点一下)。证书中包含了两个密钥，一个公钥一个私钥。
- 服务端将公钥返回到客户端，公钥中包含了证书颁发机构，证书过期时间等信息。
- 客户端收到公钥后，通过 SSl/TSL 层首先对公钥信息进行验证，如颁发机构过期时间等，如果发现异常，则会弹出一个警告框，提示证书存在问题。否则就生成一个随机值，然后使用公钥对此随机值进行加密，此加密信息只能通过服务端的私钥才能解密获取生成的随机值。
- 服务端获取到加密信息后使用私钥解密获得随机值，以后服务端和客户端的通讯都会使用此随机值进行加密，而这个时候，只有服务端和客户端才知道这个随机值 (私钥)，服务端将要返回给客户端的数据通过随机值加密后返回。
- 客户端用之前生成的随机值解密服务段传过来的信息，于是获取了解密后的内容，整个过程第三方即使监听到了数据，也束手无策。

### <span id="jump1">http1、http2</span>

相对于 HTTP1.0，HTTP1.1 的优化：

- 缓存处理：多了 Entity tag，If-Unmodified-Since, If-Match, If-None-Match 等缓存信息（HTTTP1.0 If-Modified-Since,Expires）
- 带宽优化及网络连接的使用
- 错误通知的管理
- Host 头处理
- 长连接： HTTP1.1 中默认开启 Connection： keep-alive，一定程度上弥补了 HTTP1.0 每次请求都要创建连接的缺点。

相对于 HTTP1.1，HTTP2 的优化：

- HTTP2 支持二进制传送（实现方便且健壮），HTTP1.x 是字符串传送
- HTTP2 支持多路复用
- HTTP2 采用 HPACK 压缩算法压缩头部，减小了传输的体积
- HTTP2 支持服务端推送

----

### <span id="jump2">http 和 https<span>

> http 优点：

- ①灵活可扩展。一个是语法上只规定了基本格式，空格分隔单词，换行分隔字段等。另外一个就是传输形式上不仅可以传输文本，
还可以传输图片，视频等任意数据
- ②请求 - 应答模式。通常而言，就是一方发送消息，另外一方要
接受消息，或者是做出相应等
- ③可靠传输。HTTP 是基于 TCP/IP，因此把这一特性继承了下来。
- ④无状态。这个分场景回答即可

> http 缺点：

- ①无状态，有时候，需要保存信息，比如像购物系统，需要保留下顾客信息等等，另外一方面，有时候，无状态也会减少网络开
销，比如类似直播行业这样子等，这个还是分场景来说
- ②明文传输，即协议里的报文 (主要指的是头部) 不使用二进制数据，而是文本形式。这让 HTTP 的报文信息暴露给了外界，给攻击者带来了便利
- ③队头阻塞，当 http 开启长连接时，共用一个 TCP 连接，当某个请求时间过长时，其他的请求只能处于阻塞状态，这就是队头阻塞问题。

> HTTPS

- HTTPS 要比 HTTPS 多了 secure 安全性这个概念，实际上， HTTPS 并不是一个新的应用层协议，它其实就是 HTTP + TLS/SSL 协议组合而成，而安全性的保证正是 SSL/TLS 所做的工作。

> 区别：

- HTTP 是明文传输协议，HTTPS 协议是由 SSL+HTTP 协议构建的可进行加密传输、身份认证的网络协议，比 HTTP 协议安全
- HTTPS 比 HTTP 更加安全，对搜索引擎更友好，利于 SEO,谷歌、百度优先索引 HTTPS 网页
- HTTPS 标准端口 443，HTTP 标准端口 80
- HTTPS 需要用到 SSL 证书，而 HTTP 不用

----

### <span id="jump3">HTTP 与 TCP 的区别和联系</span>

- **TCP 是底层通讯协议**，定义的是数据传输和连接方式的规范
- **HTTP 是应用层协议**，定义的是传输数据的内容的规范
- HTTP 协议中的数据是利用 TCP 协议传输的，所以支持 HTTP 也就一定支持 TCP
- HTTP 支持的是 www 服务 ；
- 而 TCP/IP 是协议是 Internet 国际互联网络的基础。TCP/IP 是网络中使用的基本的通信协议。

> TCP 连接

**建立起一个 TCP 连接需要经过“三次握手”：**

第一次握手：客户端发送 syn 包 (syn=j) 到服务器，并进入 SYN_SEND 状态，等待服务器确认；

第二次握手：服务器收到 syn 包，必须确认客户的 SYN（ack=j+1），同时自己也发送一个 SYN 包（syn=k），即 SYN+ACK 包，此时服务器进入 SYN_RECV 状态；

第三次握手：客户端收到服务器的 SYN＋ACK 包，向服务器发送确认包 ACK(ack=k+1)，此包发送完毕，客户端和服务器进入 ESTABLISHED 状态，完成三次握手。

握手过程中传送的包里不包含数据，三次握手完毕后，客户端与服务器才正式开始传送数据。理想状态下，TCP 连接一旦建立，在通信双方中的任何一方主动关闭连 接之前，TCP 连接都将被一直保持下去。断开连接时服务器和客户端均可以主动发起断开 TCP 连接的请求，断开过程需要经过“四次握手”（过程就不细写 了，就是服务器和客户端交互，最终确定断开）

> HTTP 连接

HTTP 协议即超文本传送协议 (Hypertext Transfer Protocol )，是 Web 联网的基础，也是手机联网常用的协议之一，**HTTP 协议是建立在 TCP 协议之上的一种应用。**

HTTP 连接最显著的特点是客户端发送的每次请求都需要服务器回送响应，在请求结束后，会主动释放连接。从建立连接到关闭连接的过程称为“一次连接”。

1）在 HTTP 1.0 中，客户端的每次请求都要求建立一次单独的连接，在处理完本次请求后，就自动释放连接。

2）在 HTTP 1.1 中则可以在一次连接中处理多个请求，并且多个请求可以重叠进行，不需要等待一个请求结束后再发送下一个请求。

由于 HTTP 在每次请求结束后都会主动释放连接，因此 HTTP 连接是一种“短连接”，要保持客户端程序的在线状态，需要不断地向服务器发起连接请求。通常的 做法是即时不需要获得任何数据，客户端也保持每隔一段固定的时间向服务器发送一次“保持连接”的请求，服务器在收到该请求后对客户端进行回复，表明知道客 户端“在线”。若服务器长时间无法收到客户端的请求，则认为客户端“下线”，若客户端长时间无法收到服务器的回复，则认为网络已经断开。

### <span id="jump4">WebSocket 原理</span>

-----

WebSocket 同 HTTP 一样也是应用层的协议，但是它是一种双向通信协议，是建立在 TCP 之上的。

WebSocket 是一种在单个 TCP 连接上进行全双工通信的协议。WebSocket API 也被 W3C 定为标准。

WebSocket 使得客户端和服务器之间的数据交换变得更加简单，允许服务端主动向客户端推送数据。在 WebSocket API 中，浏览器和服务器只需要完成一次握手， 两者之间就直接可以创建持久性的连接，并进行双向数据传输。

Websocket 默认使用请求协议为:ws://,默认端口:80。对 TLS 加密请求协议为:wss://，端口:443。

-----

### <span id="jump5">webSocket 与 HTTP 的关系</span>

相同点：

- 都是一样基于 TCP 的，都是可靠性传输协议。
- 都是应用层协议。

不同点:

- WebSocket 是双向通信协议，模拟 Socket 协议，可以双向发送或接受信息。
- HTTP 是单向的。
- WebSocket 是需要握手进行建立连接的。

联系：

WebSocket 在建立握手时，数据是通过 HTTP 传输的。但是建立之后，在真正传输时候是不需要 HTTP 协议的。

### <span id="jump8">报文结构</span>

HTTP 报文有 请求报文 和 响应报文 两种。

- 请求报文：从客户向服务器发送请求报文。
- 响应报文：从服务端到客户的回答。

HTTP 的这两种报文都由三部分组成：开始行、首部行、实体主体。

请求行： 由方法、[空格]、URL、[空格]、HTTP 版本 组成

响应行： 由 HTTP 版本、[空格]、状态码组成。

首部行：

1.是用来说明浏览器、服务器或报文主体的一些信息。
2.可以有好几行，也可以不使用
3.每个首部行都是由 首部字段名、[空格] 和 值 组成
4.每个首部行在结束地方都有 CRLF（『回车』和『换行』符）

HTTP 首部字段分为 4 种： 通用首部字段、请求首部字段、响应首部字段、实体首部字段。

实体主体

在请求报文中，一般是 post/put 提交的表单信息, queryParmas、formData

![baowen](https://user-images.githubusercontent.com/25680922/125020439-701e5e80-e0ab-11eb-9c00-c6ed928013d3.png)

### <span id="jump9">协议 - 分层.</span>

> TCP/IP 它并不特指单纯的 TCP 和 IP 协议，而是容纳了许许多多的网络协议。

#### IP 协议

IP 是 互联网协议 (Internet Protocol) ，位于网络层。IP 是整个 TCP/IP 协议族的核心，也是构成互联网的基础。IP 能够为运输层提供数据分发，同时也能够组装数据供运输层使用。它将多个单个网络连接成为一个互联网，这样能够提高网络的可扩展性，实现大规模的网络互联。二是分割顶层网络和底层网络之间的耦合关系。

#### TCP 协议

TCP 就是 传输控制协议，也就是 Transmission Control Protocol，它是一种面向连接的、可靠的、基于字节流的传输协议，TCP 协议位于传输层，TCP 协议是 TCP/IP 协议簇中的核心协议，它最大的特点就是提供可靠的数据交付。

TCP 的主要特点有 慢启动、拥塞控制、快速重传、可恢复。

#### UDP 协议

UDP 协议就是 用户数据报协议，也就是 User Datagram Protocol，UDP 也是一种传输层的协议，与 TCP 相比，UDP 提供一种不可靠的数据交付，也就是说，UDP 协议不保证数据是否到达目标节点，也就是说，当报文发送之后，是无法得知其是否安全完整到达的。UDP 是一种无连接的协议，传输数据之前源端和终端无需建立连接，不对数据报进行检查与修改，无须等待对方的应答，会出现分组丢失、重复、乱序等现象。但是 UDP 具有较好的实时性，工作效率较 TCP 协议高。

#### FTP 协议

FTP 协议是 文件传输协议，英文全称是 File Transfer Protocol，应用层协议之一，是 TCP/IP 协议的重要组成之一，FTP 协议分为服务器和客户端两部分，FTP 服务器用来存储文件，FTP 客户端用来访问 FTP 服务器上的文件，FTP 的传输效率比较高，所以一般使用 FTP 来传输大文件。

## OSI 标准模型

![tcp](https://user-images.githubusercontent.com/25680922/125020509-8c220000-e0ab-11eb-8df9-96e09b5b6ea5.png)

OSI 模型共有七层，从下到上分别是物理层、数据链路层、网络层、运输层、会话层、表示层和应用层。但是这显然是有些复杂的，所以在 TCP/IP 协议中，它们被简化为了四个层次

和 OSI 七层网络协议的主要区别如下

应用层、表示层、会话层三个层次提供的服务相差不是很大，所以在 TCP/IP 协议中，它们被合并为应用层一个层次。

由于数据链路层和物理层的内容很相似，所以在 TCP/IP 协议中它们被归并在网络接口层一个层次里。

## TCP/IP 协议中四个层次

应用层

传输层

网络层

通信链路层

## 各个分层的主要作用如下

应用层：应用层是 OSI 标准模型的最顶层，是直接为应用进程提供服务的。其作用是在实现多个系统应用进程相互通信的同时，完成一系列业务处理所需的服务。包括文件传输、电子邮件远程登录和远端接口调用等协议。

表示层: 表示层向上对应用进程服务，向下接收会话层提供的服务，表示层位于 OSI 标准模型的第六层，表示层的主要作用就是将设备的固有数据格式转换为网络标准传输格式。

会话层：会话层位于 OSI 标准模型的第五层，它是建立在传输层之上，利用传输层提供的服务建立和维持会话。

传输层：传输层位于 OSI 标准模型的第四层，它在整个 OSI 标准模型中起到了至关重要的作用。传输层涉及到两个节点之间的数据传输，向上层提供可靠的数据传输服务。传输层的服务一般要经历传输连接建立阶段，数据传输阶段，传输连接释放阶段 3 个阶段才算完成一个完整的服务过程。

网络层：网络层位于 OSI 标准模型的第三层，它位于传输层和数据链路层的中间，将数据设法从源端经过若干个中间节点传送到另一端，从而向运输层提供最基本的端到端的数据传送服务。

数据链路层：数据链路层位于物理层和网络层中间，数据链路层定义了在单个链路上如何传输数据。

物理层：物理层是 OSI 标准模型中最低的一层，物理层是整个 OSI 协议的基础，就如同房屋的地基一样，物理层为设备之间的数据通信提供传输媒体及互连设备，为数据传输提供可靠的环境。
