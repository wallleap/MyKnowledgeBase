---
title: 037-Vue çš„æ„é€ é€‰é¡¹
date: 2023-05-20T02:17:00+08:00
updated: 2024-08-21T10:32:38+08:00
dg-publish: false
aliases:
  - Vue çš„æ„é€ é€‰é¡¹
author: Luwang
category: web
comments: true
cover: //cdn.wallleap.cn/img/post/1.jpg
description: æ–‡ç« æè¿°
image-auto-upload: true
keywords:
  - å…³é”®è¯1
  - å…³é”®è¯2
  - å…³é”®è¯3
rating: 1
source: #
tags:
  - web
url: //myblog.wallleap.cn/post/1
---

## åˆ›å»º Vue å®ä¾‹

```js
const vm = new Vue({
  el: '#app',
  template: `<div>{{msg}}</div>`,
  data: {
    msg: 'Hello Vue'
  }
  methods: {}
})
```

`new Vue()` å°±æ˜¯æ„é€ ä¸€ä¸ª Vue å®ä¾‹

`new Vue(options)` å®ä¾‹æ ¹æ®é€‰é¡¹å¾—åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥å‘½åä¸º vmï¼Œ`const vm = new Vue(options)`ï¼Œè¯¥å¯¹è±¡å°è£…äº† DOM å¯¹è±¡åŠæ“ä½œï¼Œåªéœ€è¦è°ƒç”¨ API å°±å¯ä»¥äº†

- æŠŠ Vue çš„å®ä¾‹å‘½åä¸º `vm` æ˜¯å°¤é›¨æºªçš„ä¹ æƒ¯ï¼Œæˆ‘ä»¬åº”è¯¥æ²¿ç”¨
- `vm` å¯¹è±¡**å°è£…**äº†å¯¹è§†å›¾çš„æ‰€æœ‰æ“ä½œï¼ŒåŒ…æ‹¬**æ•°æ®è¯»å†™**ã€**äº‹ä»¶ç»‘å®š**ã€**DOM æ›´æ–°**
- `vm` çš„æ„é€ å‡½æ•°æ˜¯ `Vue`ï¼ŒæŒ‰ç…§ ES 6 çš„è¯´æ³•ï¼Œ`vm` æ‰€å±çš„**ç±»æ˜¯ `Vue`**
- `options` æ˜¯ `new Vue()` çš„å‚æ•°ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç§°ä¹‹ä¸º**é€‰é¡¹**æˆ–**æ„é€ é€‰é¡¹**

`vm.__proto__` === `Vue.prototype`ï¼ˆå®ä¾‹çš„éšè—å±æ€§å’Œæ„é€ å‡½æ•°çš„ `prototype` å­˜çš„æ˜¯åŒä¸€ä¸ªåœ°å€å€¼ï¼‰

`Vue.__proto__` === `Function.prototype` ï¼ˆVue æ˜¯ä¸€ä¸ªæ„é€ **å‡½æ•°**ï¼‰

## æ„é€ é€‰é¡¹ä¸­æœ‰ä»€ä¹ˆ

åˆ°æ–‡æ¡£ä¸­æœç´¢â€œé€‰é¡¹â€æˆ–è€…â€œoptionsâ€

options çš„äº”ç±»å±æ€§ï¼š

- æ•°æ®ï¼š`data`ï¼ˆæ•°æ®ï¼‰ã€`props`ï¼ˆå±æ€§ï¼‰ã€`propsData`ï¼ˆpropsValueï¼‰ã€`computed`ï¼ˆè®¡ç®—ï¼‰ã€`methods`ï¼ˆæ–¹æ³•ï¼‰ã€`watch`ï¼ˆè§‚å¯Ÿï¼‰
- DOMï¼š`el`ï¼ˆå®¹å™¨æˆ–æŒ‚è½½ç‚¹ï¼‰ã€`template`ï¼ˆHTML å†…å®¹ï¼‰ã€`render`ï¼ˆæ¸²æŸ“ï¼Œå’Œå‰é¢é‚£ä¸ªäºŒé€‰ä¸€ï¼‰ã€`renderError`
- ç”Ÿå‘½å‘¨æœŸé’©å­ï¼š`beforeCreate`ã€`created`ã€`beforeMount`ã€`mounted`ã€`beforeUpdate`ã€`updated`ã€`activated`ã€`deactivated`ã€`beforeDestroy`ã€`destroyed`ã€`errorCaptured`
	- ç”Ÿå‘½å‘¨æœŸï¼šcreateElementï¼ˆcreated åˆ›å»ºäº†ï¼‰ã€appendï¼ˆmounted æŒ‚è½½åˆ°é¡µé¢ä¸­ï¼‰ã€updatedï¼ˆæ›´æ–°ï¼‰ã€destroyedï¼ˆæ¶ˆäº¡ï¼‰
	- é’©å­ï¼šå¯ä»¥åˆ‡å…¥çš„ç‚¹
- èµ„æºï¼š`directives`ï¼ˆæŒ‡ä»¤ï¼‰ ã€`filters`ï¼ˆè¿‡æ»¤å™¨ï¼‰ã€`components`ï¼ˆç»„ä»¶ï¼‰
- ç»„åˆï¼š`parent`ã€`mixins`ï¼ˆæ··å…¥ï¼‰ã€`extends`ï¼ˆæ‰©å±•ï¼‰ã€`provide`ï¼ˆæä¾›ï¼‰ã€`inject`ï¼ˆæ³¨å…¥ï¼‰
- å…¶ä»–

æŠŠä¸Šé¢çš„å±æ€§åˆ†ä¸‹ç±»ï¼š

1. å…¥é—¨å±æ€§ï¼Œç®€å•ã€é‡è¦ï¼š
	- `data`ã€`props`ã€`methods`
	- `el`
	- `created`ã€`mounted`ã€`updated`ã€`destroyed`
	- `components`
2. è®°ä½ä¸Šé¢ä¸­å°±èƒ½è®°ä½çš„ï¼š
	- `renderError`
	- `beforeCreate`ã€`beforeMount`ã€`beforeUpdate`ã€`beforeDestroy`
3. é«˜çº§å±æ€§ï¼Œç†è§£è´¹åŠ›ä¸€ç‚¹
	- `computed`ã€`watch`
	- `activated`ã€`deactivated`
	- `directives`
	- `mixins`ã€`extends`ã€`provide`ã€`inject`
4. ä¸å¸¸ç”¨
	- `propsData`ã€`render`
5. éå¸¸ä¸å¸¸ç”¨ï¼Œç”¨çš„æ—¶å€™çœ‹æ–‡æ¡£
	- `errorCaptured`ã€`parent`ã€å…¶ä»–
6. ç‰¹æ®Šçš„
	- `template`ï¼ˆè¯­æ³•ï¼‰ã€`filters`ï¼ˆå°½é‡ä¸ç”¨ï¼‰

> å‡½æ•°å’Œæ–¹æ³•ï¼šéƒ½æŒ‡çš„ `funtion(p1, p2) {}`
>
> - å‡½æ•°ï¼šæ•°å­¦æ¦‚å¿µ
> - æ–¹æ³•ï¼šé¢å‘å¯¹è±¡ä¸­ï¼Œä¸€èˆ¬ä¾é™„äºå¯¹è±¡ï¼ˆ`å¯¹è±¡.fun()`ï¼‰

## å…¥é—¨å±æ€§

### 1ã€æŒ‚è½½ç‚¹

æŒ‚è½½åˆ°å“ªä¸ªå®¹å™¨ä¸Šï¼ˆé¡µé¢ä¸Šå·²ç»å­˜åœ¨çš„ DOM å…ƒç´ ï¼‰ï¼Œå€¼ä¸ºÂ CSS é€‰æ‹©å™¨æˆ–æ˜¯ä¸€ä¸ª HTMLElement å®ä¾‹

```js
new Vue({
  el: '#app',
  render: h => h(MyDemo)
})
```

`el` ä¸ `$mount` æœ‰**æ›¿æ¢å…³ç³»**

æ²¡æœ‰ `el` è¿™ä¸ªé€‰é¡¹çš„æ—¶å€™éœ€è¦æ˜¾å¼è°ƒç”¨Â `vm.$mount()`Â æ‰‹åŠ¨å¼€å¯ç¼–è¯‘

```js
new Vue({
  render: h => h(MyDemo),
}).$mount('#app')
```

åœ¨å®ä¾‹æŒ‚è½½ä¹‹åï¼Œå…ƒç´ å¯ä»¥ç”¨ `vm.$el` è®¿é—®

### 2ã€å†…éƒ¨æ•°æ®

`data` å¯ä»¥æ˜¯å¯¹è±¡æˆ–å‡½æ•°

```js
new Vue({
  data: { n: 0 }
})
new Vue({
  data: function() {
    return {  // è¿”å›ä¸€ä¸ªå¯¹è±¡
      n: 0
    }
  }
})
// â†“ ç¼©å†™
new Vue({
  data() {
    return {
      n: 0
    }
  }
})
```

**ä¼˜å…ˆç”¨å‡½æ•°**ï¼ˆç»„ä»¶çš„å®šä¹‰åªæ¥å— functionï¼‰

- `data` å†™åœ¨ `.vue` æ–‡ä»¶ï¼ˆç»„ä»¶ï¼‰ä¸­å¿…é¡»è¦æ˜¯å‡½æ•°å½¢å¼ï¼ˆ`import` çš„ç»„ä»¶ MyDemo æœ¬è´¨æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼‰
- åœ¨ç»„ä»¶å¤ç”¨çš„æ—¶å€™ï¼Œå¦‚æœ `data` æ˜¯å¯¹è±¡ï¼Œç”¨çš„æ˜¯åŒä¸€ä¸ª `data`ï¼ˆå…±ç”¨ `data`ï¼‰
- ç”¨å‡½æ•°çš„è¯ï¼Œå¤ç”¨çš„æ—¶å€™å¾—åˆ°çš„æ˜¯ä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ï¼ˆå‡½æ•°ä¸­æ–° return çš„ï¼‰

### 3ã€æ–¹æ³•

äº‹ä»¶å¤„ç†å‡½æ•°æˆ–æ™®é€šå‡½æ•°

```js
new Vue({
  data: { n: 1 },
  template: `
    <div>{{n}}<button @click="add">+1</button></div>
  `
  methods: {
    plus: function() {
      this.n++
    }
  }
})
// åœ¨ {{}} ä¸­ä½¿ç”¨å‡½æ•°
new Vue({
  data: {
    arr: [1,2,3,4,5,6]
  },
  template: `
    <div>{{array.filter(i => i % 2 === 0)}}</div>
  `
})
// å†™åœ¨ methods ä¸­ åœ¨æ¨¡æ¿ä¸­ä¸»åŠ¨è°ƒç”¨
new Vue({
  template: `<div>{{filter(arr)}}</div>`, // {{filter()}}
  methods: {
    filter(arr) {
      return arr.filter(i => i % 2 === 0)  // return this.arr.filter()
    }
  }
})
```

æŠŠ add å‡½æ•°å†™åœ¨ methods å¤–ä¼šæŠ¥é”™ `add is not defined`

- methods æœ‰ä¸ªç‰¹æ€§ï¼š**æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šæ‰§è¡Œ**
- é‡Œé¢çš„æ–¹æ³•ä¸­çš„ `this` è‡ªåŠ¨ç»‘å®šçš„æ˜¯ Vue å®ä¾‹ï¼Œæ‰€ä»¥ä¸åº”è¯¥ä½¿ç”¨ç®­å¤´å‡½æ•°ï¼ˆVue é€‰é¡¹ä¸­æ‰€æœ‰åœ°æ–¹ï¼‰æ¥å®šä¹‰æ–¹æ³•ï¼ˆç®­å¤´å‡½æ•°æ²¡æœ‰è‡ªå·±çš„ `this`ï¼Œå®ƒé‡Œé¢çš„ `this` å°±æ˜¯å£°æ˜æ—¶å¤–é¢çš„ `this`ï¼‰
- é‡Œé¢çš„æ–¹æ³•å¯ä»¥ç›´æ¥ç”¨ `vm.add()` è°ƒç”¨ï¼Œdata é‡Œçš„å˜é‡ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ `vm.n` è®¿é—®åˆ°

### 4ã€ç»„ä»¶

`vm` æ˜¯ Vue ï¼ˆçš„ï¼‰å¯¹è±¡/Vueï¼ˆçš„ï¼‰å®ä¾‹

`components` ä½¿ç”¨ Vue ç»„ä»¶ï¼Œç»„ä»¶æ˜¯å¯å¤ç”¨çš„ Vue å®ä¾‹

ç¬¬ä¸€ç§ï¼šæ¯ä¸ªç»„ä»¶æ˜¯ä¸€ä¸ªå•ç‹¬çš„ `.vue` æ–‡ä»¶

ä¾‹å¦‚ `MyDemo.vue`

```vue
<template>
  <div class="red">
    {{ count }}
    <button @click="add">+1</button>
  </div>
</template>

<script>
export default {
  data() {
    return {
      count: 0
    }
  },
  methods: {
    add() {
      this.count += 1
    }
  }
}
</script>

<style scoped>
.red {
  color: red;
}
</style>

```

åœ¨ `main.js` ä¸­å¼•å…¥å¹¶ä½¿ç”¨

```js
import MyDemo from './MyDemo.vue'
new Vue({
  components: {
    RenameDemo: MyDemo // MyDemo: MyDemo â†’ ç¼©å†™ MyDemo
  },
  template: `<div><RenameDemo /></div>`
})
```

ä¼˜å…ˆä½¿ç”¨è¿™ç§æ–¹å¼

- æ–‡ä»¶åä¸€èˆ¬å…¨ç”¨å°å†™ï¼ˆä¸‹åˆ’çº¿è¿æ¥ ä¾‹ `my_demo.vue`ï¼‰æœ‰äº›æ“ä½œç³»ç»Ÿè¯†åˆ«ä¸äº†å¤§å°å†™
- ç»„ä»¶æœ€å¥½é¦–å­—æ¯å¤§å†™ï¼Œé©¼å³°å‘½åï¼ˆä»£ç ä¸Šå¯ä»¥å’ŒåŸç”Ÿ HTML æ ‡ç­¾åŒºåˆ†ï¼‰

ç¬¬äºŒç§ï¼šä½¿ç”¨ JS çš„æ–¹å¼ï¼ˆå…¨å±€ï¼‰

```js
Vue.component('MyDemo2', {
  template: `<div>Demo2</div>`
})
new Vue({
  template: `<div><MyDemo2 /><MyDemo2 /></div>`
})
```

- ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯åå­—/id
- ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯å®ä¾‹é€‰é¡¹ï¼Œä»…æœ‰çš„ä¾‹å¤–æ˜¯åƒÂ `el`Â è¿™æ ·æ ¹å®ä¾‹ç‰¹æœ‰çš„é€‰é¡¹
- ç»„ä»¶å¯ä»¥å¤ç”¨ï¼Œä¾‹å¦‚ä¸Šé¢çš„ `<MyDemo2 /><MyDemo2 />`

ç¬¬ä¸‰ç§ï¼šç»“åˆä¸Šé¢ä¸¤ç§

```js
const x = {
  template: `<div>hello demo3</div>`
}
new Vue({
  components: {
    MyDemo3: x
  },
  template: `<div><MyDemo3 /></div>`
})
```

ç»„ä»¶å°±æ˜¯å¯ä»¥ç»„åˆçš„ç‰©ä»¶

### 5ã€å››ä¸ªé’©å­

`created` å®ä¾‹å‡ºç°åœ¨å†…å­˜ä¸­

`mounted` å®ä¾‹å‡ºç°åœ¨é¡µé¢ä¸­

`updated` å®ä¾‹æ›´æ–°äº†

`destroyed` å®ä¾‹æ¶ˆäº¡äº†

æµ‹è¯•ï¼š

`MyDemo.vue`

```vue
<template>
  <div>{{n}}<button @click="add">+1</button></div>
</template>
<script>
export default {
  data() {
    return {
      n: 0
    }
  },
  methods: {
    add() {
      this.n++
    }
  },
  created() {
    console.log('å‡ºç°åœ¨å†…å­˜ä¸­ï¼Œæ²¡æœ‰å‡ºç°åœ¨é¡µé¢ä¸­')
  },
  mounted() {
    console.log('å‡ºç°åœ¨é¡µé¢ä¸­')
  },
  updated() {
    console.log('æ›´æ–°äº†ï¼Œn: ', n)
  },
  destroyed() {
    console.log('å·²ç»æ¶ˆäº¡äº†')
  }
}
</script>
```

`main.js` ä¸­

```js
import MyDemo from './MyDemo.vue'
new Vue({
  componets: { MyDemo },
  data() {
    return {
      visible = true
    }
  },
  template: `
    <div>
      <button @click="toggle">åˆ‡æ¢</button><br>
      <MyDemo />
    </div>
  `,
  methods: {
    toogle() {
      this.visible != this.visible
    }
  }
}).$mount('#frank')
```

ç‚¹å‡»ä¼šä¸æ–­åˆ›å»ºæ–°çš„ï¼Œä¸”åœ¨æ–°çš„å†…å­˜ä¸­ï¼ˆn ä¼šé‡æ–°å˜æˆ 0ï¼‰

### 6ã€å¤–éƒ¨å±æ€§

`props`

MyDemo åªå±•ç°å¤–éƒ¨çš„ `msg`

```vue
<template>
  <div>{{msg}}</div> <!-- Vue å…è®¸çœç•¥ thisï¼ˆthis.msgï¼‰ -->
</template>
<script>
export default {
  props: ['msg']
}
</script>
```

åœ¨å¤–éƒ¨ä¼ å…¥ `msg`

```js
import MyDemo from './MyDemo.vue'
new Vue({
  componets: { MyDemo },
  template: `<div><MyDemo msg="Hello props" /></div>`
}).$mount('#app')
```

é‡Œé¢çš„æ˜¯å­—ç¬¦ä¸²ï¼Œæ€æ ·ä¼ å˜é‡ç­‰å…¶ä»–å†…å®¹

```js
<MyDemo :msg="0" /> â†’ æ•°å­— 0
<MyDemo :msg="n" /> â†’ å˜é‡ n
<MyDemo :msg="n" :fn="add" /> â†’ å‡½æ•°ï¼ŒåŒæ—¶ä¼ å¤šä¸ª
å­ç»„ä»¶å¯ä»¥è°ƒç”¨ props: ['msg', 'fn'] @click = "fn"
<!-- å‰é¢åŠ ä¸ª: å¼•å·ä¸­çš„æ˜¯ JS -->
```

åœ¨çœ‹å…¶ä»–å±æ€§ä¹‹å‰å¯ä»¥å…ˆçœ‹ä¸‹ [[038-Vue ä¸­çš„æ•°æ®å“åº”å¼]]

options.data

- ä¼šè¢« Vue ç›‘å¬
- ä¼šè¢« Vue å®ä¾‹ä»£ç†
- æ¯æ¬¡å¯¹ data çš„è¯»å†™éƒ½ä¼šè¢« Vue ç›‘æ§
- Vue ä¼šåœ¨ data å˜åŒ–æ—¶æ›´æ–° UI

## è¿›é˜¶å±æ€§

### 1ã€è®¡ç®—å±æ€§

data å˜åŒ–æ—¶é™¤äº†æ›´æ–° UIï¼Œè¿˜èƒ½åšç‚¹ä»€ä¹ˆ

computed ç”¨é€”ï¼šè¢«è®¡ç®—å‡ºæ¥çš„å±æ€§å°±å«åš**è®¡ç®—å±æ€§**

ğŸŒ° æ —å­ä¸€ï¼šç”¨æˆ·åå±•ç¤º

```js
new Vue({
  data: {
    user: {
      email: 'a@qq.com',
      nickname: 'luwang',
      phone: '1234567890'
    }
  },
  template: `
    <div>{{user.nickname || user.email || user.phone}}
  `  // æ²¡æœ‰æ˜µç§°åˆ™æ˜¾ç¤ºå…¶ä»–ï¼Œéœ€è¦æ˜¾ç¤ºå¤šæ¬¡çš„è¯åé¢ä¿®æ”¹ä¸æ–¹ä¾¿
}).$mount('#app')
```

å¯ä»¥ä½¿ç”¨è®¡ç®—å±æ€§ï¼Œç›´æ¥è®¿é—®æˆ–ä¿®æ”¹ data ä¸­çš„æ•°æ® `this.xxx`

```js
new Vue({
  data: ...,
  computed: {
    dispalyName() {  // ä¸€ä¸ª getter
      const user = this.user
      return user.nickname || user.email || user.phone
    },
    template: `<div>{{displayName}}</div>`  // è¿™æ ·æ¯æ¬¡éƒ½å†™è¿™ä¸ªå°±è¡Œï¼Œä¸éœ€è¦åŠ æ‹¬å·
  }
})
```

é»˜è®¤åªæœ‰ getterï¼Œä¹Ÿå¯ä»¥ç”¨å¯¹è±¡å½¢å¼ï¼Œä¼ å…¥ get å’Œ set

```js
computed: {
  displayName: {
    get() {  // getter
      const user = this.user
      return user.nickname || user.email || user.phone
    },
    set(value) {  // setter
      this.user.nickname = value
    }
  }
}
```

ğŸŒ° æ —å­äºŒï¼šå±•ç¤ºåˆ—è¡¨

```js
let id = 0
const createUser = (name, gender) => ({id: id, name: name, gender: gender})  // å°è£…ä¹‹åå°±ä¸éœ€è¦æ¯æ¬¡å†™ {id: 0, name: 'Tom', gender: 'male'} è¿™ç§

new Vue({
  data() {
    return {
      users: [
        createUser('Tom', 'male'),
        createUser('Jack', 'male'),
        createUser('Hong', 'female'),
        createUser('Ming', 'female')
      ],
      displayUsers: []
    }
  },
  created(){
    this.displayUsers = this.users
  },
  template: `
    <div>
      <div>
        <button @click="showAll">All</button>
        <button @click="showMale">Male</button>
        <button @click="showFemale">Female</button>
       </div>
       <ul>
	     <li v-for="(u, index) in displayUsers" :key="index">{{u.name}} - {{u.gender}}</li>
       </ul>
    </div>
  `,
  methods: {
    showMale() {
      this.displayUsers = this.users.filter(u => u.gender === 'ç”·')
    },
    showMale() {
      this.displayUsers = this.users.filter(u => u.gender === 'å¥³')
    },
    showAll() {
      this.displayUsers = this.users
    }
  }
}).$mount('#app')
```

æ¨¡æ¿å†…çš„è¡¨è¾¾å¼éå¸¸ä¾¿åˆ©ï¼Œä½†æ˜¯è®¾è®¡å®ƒä»¬çš„åˆè¡·æ˜¯ç”¨äºç®€å•è¿ç®—çš„ï¼Œåœ¨æ¨¡æ¿ä¸­æ”¾å…¥å¤ªå¤šçš„é€»è¾‘ä¼šè®©æ¨¡æ¿è¿‡é‡ä¸”éš¾ä»¥ç»´æŠ¤

å¯¹äºä»»ä½•å¤æ‚é€»è¾‘ï¼Œä½ éƒ½åº”å½“ä½¿ç”¨**è®¡ç®—å±æ€§**

```js
let id = 0
const createUser = (name, gender) => ({id: id, name: name, gender: gender})

new Vue({
  data() {
    return {
      users: [
        createUser('Tom', 'male'),
        createUser('Jack', 'male'),
        createUser('Hong', 'female'),
        createUser('Ming', 'female')
      ],
      gender: ''  // æ–°å¢ä¸€ä¸ªæ”¾æ€§åˆ«çš„å±æ€§
    }
  },
  computed: {
    displayUsers() {
      console.log('computed')
      // è¡¨é©±åŠ¨ hash = {male: 'ç”·', female: 'å¥³'}
      const {users, gender} = this  // ææ„ï¼Œåé¢ç”¨å˜é‡æ›´çŸ­ç‚¹
      if(gender === '') {
        return users
      } else if(gender === 'male') {
        return users.filter(u => u.gender === 'ç”·')
      } else if(gender === 'female') {  // è¿™ä¸¤æ¡åªè¦æ˜¯å­—ä¸²å°±å¯ä»¥ï¼Œæ‰€ä»¥å¯ä»¥æ”¹æˆè¡¨é©±åŠ¨ hase[gender]
        return users.filter(u => u.gender === 'å¥³')
      } else {
        throw new Error('invale value')
      }
    }
  }
  template: `
    <div>
      <div>
        <button @click="gender = ''">All</button>
        <button @click="gender = 'male'">Male</button>
        <button @click="gender = 'female'">Female</button>  // æˆ–è€…åŒä¸€ä¸€ä¸‹ setGender(string)
       </div>
       <ul>
	     <li v-for="(u, index) in displayUsers" :key="index">{{u.name}} - {{u.gender}}</li>
       </ul>
    </div>
  `
}).$mount('#app')
```

åœ¨æ —å­äºŒå¯ä»¥å°†åŒä¸€å‡½æ•°å®šä¹‰ä¸ºä¸€ä¸ªæ–¹æ³•è€Œä¸æ˜¯ä¸€ä¸ªè®¡ç®—å±æ€§

ä¸¤ç§æ–¹å¼çš„**æœ€ç»ˆç»“æœ**ç¡®å®æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œç„¶è€Œï¼Œä¸åŒçš„æ˜¯**è®¡ç®—å±æ€§æ˜¯åŸºäºå®ƒä»¬çš„å“åº”å¼ä¾èµ–è¿›è¡Œç¼“å­˜çš„**

åªåœ¨ç›¸å…³**å“åº”å¼ä¾èµ–**å‘ç”Ÿ**æ”¹å˜**æ—¶å®ƒä»¬æ‰ä¼š**é‡æ–°æ±‚å€¼**ï¼ˆç‚¹äº† show all å†ç‚¹ä¸ä¼šè§¦å‘ï¼‰

ç¼“å­˜ï¼š

- å¦‚æœä¾èµ–çš„å±æ€§æ²¡æœ‰å˜åŒ–ï¼Œå°±ä¸ä¼šé‡æ–°è®¡ç®—
- getter / setter é»˜è®¤ä¸ä¼šåšç¼“å­˜ï¼ŒVue åšäº†ç‰¹æ®Šå¤„ç†

### 2ã€ä¾¦å¬/ç›‘å¬

watch ç”¨é€”ï¼šå½“**æ•°æ®å˜åŒ–**æ—¶ï¼Œ**æ‰§è¡Œ**ä¸€ä¸ª**å‡½æ•°**

ğŸŒ° ä¾‹å­ 1ï¼šæ’¤æ¶ˆ

watch ç®€å•ä½¿ç”¨ï¼š

```js
watch: {
  // å¯ä»¥æ˜¯å‡½æ•°
  n() {  // åå­—æ˜¯è¦ç›‘å¬çš„å†…å®¹ï¼Œn: function() {} çš„ç®€å†™ å¦‚æœæ˜¯å¤šå±‚çš„è¯éœ€è¦å¼•å· 'data.lists': function() {}
  }
  // ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡ï¼Œæœ‰çš„æ—¶å€™å¿…é¡»æ˜¯å¯¹è±¡
  n: {
    handler() {
    }
  }
}
```

å‡½æ•°ä¼šæ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ–°çš„å€¼ï¼Œç¬¬äºŒä¸ªæ˜¯æ—§çš„å€¼

å®ç°è®°å½•å’Œæ’¤æ¶ˆï¼š

```js
const vm = new Vue({
	data: {
		n: 0,
		history: [],
		inUndoMode: false  // ç”¨è¿™ä¸ªå˜é‡æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ç›‘å¬
	},
	template: `<div>
		<div>n: {{n}}</div>
		<div>
			<button @click="++n">+1</button>
			<button @click="n += 2">+2</button>
			<button @click="--n">-1</button>
			<button @click="n -= 2">-2</button>
			<button @click="undo">undo</button>
		<div>
		<div>history: {{history}}</div>
	</div>`,
	watch: {
		n(newValue, oldValue) {  // åœ¨ watch ä¸­åˆ¤æ–­æ˜¯å¦è¦ç›‘å¬ï¼ˆå¤šåŠ ä¸€ä¸ªå˜é‡ï¼‰
			console.log(this.inUndoMode)
			if(!this.inUndoMode) {
				this.history.push({from: oldValue, to: newValue})
			}
		}
	},
	methods: {
		undo() {
			const last = this.history.pop()
			this.inUndoMode = true
			// watch æ˜¯å¼‚æ­¥çš„ï¼Œä¼šå°½å¯èƒ½å¿«åœ°æ‰§è¡Œï¼ˆVue è‡ªå·±å°è£…çš„ this.$netTickï¼‰
			this.n = last.from  // ğŸŒ è¿™ä¸ª n ä¹Ÿä¼šå˜åŒ–ï¼Œä¹Ÿä¼šè¢« watch ç›‘å¬åˆ°
			// ğŸŒ å¦‚æœè¿™é‡Œæœ‰åŒæ­¥ä»£ç ï¼Œä¼šå…ˆæ‰§è¡Œè¿™ä¸ªä»£ç 
			this.$nextTick(()=>{
				this.inUndoMode = false  // æŠŠè¿™æ¡ä¹Ÿæ”¹æˆå¼‚æ­¥çš„ï¼Œå°½å¿«æ‰§è¡Œ setTimeout ä¹Ÿè¡Œ
			})
		}
	},
}).$mount('#app')
```

- éš¾ç‚¹ä¸€ï¼šæ’¤æ¶ˆçš„æ—¶å€™ï¼Œä¹Ÿä¼šä¿®æ”¹ nï¼Œå¯ä»¥åŠ ä¸ªå˜é‡åˆ¤æ–­æ˜¯å¦éœ€è¦ç›‘å¬å¤„ç†
- éš¾ç‚¹äºŒï¼šå˜é‡å€¼æ”¹å˜äº†ï¼Œåé¢æ€æ ·å˜å›å»ï¼Ÿwatch æ˜¯å¼‚æ­¥çš„ï¼Œå¯ä»¥åœ¨å¼‚æ­¥ä¸­é‡æ–°èµ‹å€¼

ğŸŒ° ä¾‹å­ 2ï¼šæ¨¡æ‹Ÿ computed

```js
new Vue({
	data: {
		user: {
			email: '1234@qq.com',
			nickname: 'Tom',
			phone: '1234567890'
		},
    displayName: ''
	},
	template: `<div>
	  <div>{{displayName}}</div>
    <div><button @click="user.nickname=undefined">åˆ é™¤ nickname</button></div>
	</div>`,
  watch: {
    'user.email': {  // éœ€è¦ç”¨åˆ°å…¶ä»–é€‰é¡¹ï¼Œä½¿ç”¨å¯¹è±¡å½¢å¼
      handler() {
        console.log('email å˜äº†')
        const {user: {email, nickname, phone}} = this  // åŒé‡ç»“æ„ï¼Œåé¢åªèƒ½ç”¨é‡Œé¢ä¸‰ä¸ªå˜é‡ï¼Œuser ç”¨ä¸äº†
        this.displayName = nickname || email || phone
      },
      immediate: true  // æœ€å¼€å§‹æ²¡æœ‰å€¼ â†’ æœ‰å€¼
    },
    'user.nickname': {
      handler() {
        console.log('nickname å˜äº†')
        const {user: {email, nickname, phone}} = this
        this.displayName = nickname || email || phone
      },
      immediate: true
    },
    'user.phone': {
      handler() {
        console.log('phone å˜äº†')
        const {user: {email, nickname, phone}} = this
        this.displayName = nickname || email || phone
      },
      immediate: true
    },
  },
}).$mount('#app')
```

æ•ˆæœå’Œ computed ä¸€æ ·ï¼Œåªæœ‰å€¼å˜åŒ–äº†æ‰ä¼šæ‰§è¡Œå‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰å˜åŒ–ï¼Œç‚¹å‡»äº†è¿˜æ˜¯ä¸ä¼šæ‰§è¡Œå‡½æ•°

- ç¬¬ä¸€æ¬¡æ‰€æœ‰çš„éƒ½å˜åŒ–ï¼Œä½†æ€æ ·è®©ä»–æ‰§è¡Œï¼Ÿå¯ä»¥ä½¿ç”¨å¯¹è±¡å½¢å¼ï¼Œæ·»åŠ  `immediate: true`
- ç›‘å¬éœ€è¦çš„å˜åŒ–ï¼Œå¦‚æœå…¨éƒ¨éƒ½è¦ç›‘å¬çš„è¯éœ€è¦å…¨éƒ¨éƒ½å†™ä¸€é
- å¦‚æœ computed å’Œ watch éƒ½èƒ½å®ç°çš„åŠŸèƒ½ï¼Œå°±ä¼˜å…ˆä½¿ç”¨ computed

ğŸŒŸ æ€æ ·æ˜¯å˜åŒ–çš„

```js
new Vue({
	data: {
		n: 0,
    obj: {
      a: 'hello'
    },
    user: {
      name: 'Tom'
    }
	},
  template: `<div>
    <button @click="n+=1">n+=1</button>
    <button @click="obj={a:'hello'}">obj={a:'hello'}</button>
    <button @click="obj.a+='hi'">obj.a+='hi'</button>
    <button @click="user={name:'Li',age:++n}">user={name:'Li',age:++n}</button>
  </div>`,
  watch: {
    n() {
      console.log(`n å˜äº† ${this.n}`)
    },
    obj() {
      console.log(`obj å˜äº† ${this.obj}`)
    },
    'obj.a'() {
      console.log(`obj.a å˜äº† ${this.obj.a}`)
    },
    user() {
      console.log(`user å˜äº† ${this.user}`)
    },
    'user.name'() {
      console.log(`user.name å˜äº† ${this.user.name}`)
    },
    'user.age'() {
      console.log(`user.age å˜äº† ${this.user.age}`)
    }
  },
}).$mount('#app')
```

å’Œå¹³å¸¸çš„ï¼ˆå…¨ç­‰åˆ¤æ–­ï¼‰æ˜¯ä¸€æ ·çš„

- åŸºæœ¬ç±»å‹çš„å€¼å˜åŒ–äº†å°±æ˜¯å˜åŒ–äº†
- å¼•ç”¨ç±»å‹çš„
	- å­˜çš„åœ°å€å˜äº†å°±æ˜¯å˜äº†ï¼ˆ`user={}` é‡æ–°èµ‹å€¼è¿™ä¸ªå°±å˜äº†ï¼‰
	- `obj.a+='hi'`ï¼Œè¿™æ ·å°±æ˜¯ `obj.a` å˜äº†ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™å†é‡æ–°èµ‹å€¼ `obj={}`ï¼Œé‚£ä¹ˆ `obj`ã€`obj.a` éƒ½å˜äº†
	- ä» undefined åˆ°æœ‰å€¼ä¹Ÿæ˜¯å˜äº†çš„

æ­£å¸¸æƒ…å†µä¸‹ï¼Œ`obj.a` å˜äº†ï¼Œ`obj` æ˜¯æ²¡æœ‰å˜çš„

- æ­¤æ—¶ `deep: false`
- å¯ä»¥ä½¿ç”¨ `deep: true`ï¼Œwatch å°†ä¼šç›‘å¬ `obj` é‡Œæ‰€æœ‰å±æ€§çš„å˜åŒ–ï¼Œè¿™æ ·å°±å¯ä»¥åªç›‘å¬ç¬¬ä¸€å±‚å°±å¯ä»¥äº†

```js
new Vue({
	data: {
    obj: {
      a: 'hello',
      b: {
        c: 1
      }
    }
	},
  template: `<div>
    <button @click="obj.a='hi'">obj.a='hi'</button>
    <button @click="obj.b.c=3">obj.b.c=3</button>
    <button @click="obj={}">obj={}</button>
  </div>`,
  watch: {
    obj: {
      handler() {
        console.log(`obj å˜äº†`)
      },
      deep: true  // åœ¨è¿™é‡Œè®¾ç½®ä¸º true
    }
  },
}).$mount('#app')
```

è¿™æ ·æ— è®ºç‚¹å‡»å“ªä¸ªæŒ‰é’®ï¼Œ`obj` éƒ½æ˜¯å˜åŒ–çš„

âœ¨ watch çš„è¯­æ³•

è¯­æ³•ä¸€ï¼š

```js
watch: {
  key1: function(newValue, oldValue) {},
  key2() {},
  key3: [f1, f2],  // å…ˆ f1 å f2
  key4: 'methodName',  // å®šä¹‰åœ¨ methods ä¸­çš„
  key5: {
    handler: fn,
    deep: true,
    immediate:true
  },  // å¯¹è±¡å½¢å¼
  'key6.a': function() {}  // å±æ€§çš„æ—¶å€™åŠ å¼•å·
}
```

è¯­æ³•äºŒï¼šå¯ä»¥æ”¾åœ¨ new Vue åé¢æˆ–è€…é’©å­ä¸­ï¼ˆä¾‹å¦‚ created ä¸­ï¼‰

```js
vm.$watch('key7', fn, {deep:true, immediate: true})
// key7 ä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆ`return 'key7'`ï¼‰
```

ğŸ”– é¢è¯•é¢˜ï¼šcomputed å’Œ watch çš„åŒºåˆ«

1ã€ï¼ˆè‹±æ–‡ç¿»è¯‘æˆä¸­æ–‡ï¼‰computed å°±æ˜¯è®¡ç®—å±æ€§çš„æ„æ€ï¼Œwatch æ˜¯ç›‘å¬æˆ–ä¾¦å¬çš„æ„æ€

2ã€ï¼ˆå„è‡ªæè¿°ï¼Œå¯ä»¥ç”¨ä»£ç ä¾‹å­ï¼‰

- computed å½¢ä¼¼æ²¡æœ‰æ‹¬å·çš„å‡½æ•°ï¼Œæœ‰ç¼“å­˜
- watch ç›‘å¬åˆ°å˜é‡å˜åŒ–å°±æ‰§è¡Œå‡½æ•°ï¼Œæœ‰ä¸¤ä¸ªç‰¹æ®Šçš„å±æ€§ï¼Œimmediate å’Œ deep

### ç‰¹æ®Šï¼šVue çš„æ¨¡ç‰ˆè¯­æ³•

æ¨¡ç‰ˆ template ä¸‰ç§å†™æ³•

ç¬¬ä¸€ç§ï¼šVue å®Œæ•´ç‰ˆï¼Œç›´æ¥å†™åœ¨ HTML ä¸­

```html
<div id="app">
  {{n}}
  <button @click="add">+1</button>
</div>
<script>
  new Vue({
    el: '#app',
    data: {n:0},
    methods:{add(){this.n++}}
  })
</script>
```

ç¬¬äºŒç§ï¼šVue å®Œæ•´ç‰ˆï¼Œå†™åœ¨é€‰é¡¹é‡Œ

```html
<div id="app"></div>
<script>
new Vue({
  template: `
    <div>{{n}}
      <button @click="add">+1</button>
    </div>`,
  data: {n:0},
  methods: {add(){this.n++}}
}).$mount('#app')
</script>
```

`div#app` ä¼šè¢«æ›¿ä»£

ç¬¬ä¸‰ç§ï¼šVue éå®Œæ•´ç‰ˆï¼Œé…åˆ xxx.vue æ–‡ä»¶

```vue
<template>
  <div>
    {{n}}
    <button @click="add">+1</button>
  </div>
</template>
<!-- template ä¸­çš„ä¸æ˜¯ HTMLï¼Œæ˜¯ XMLï¼Œæ ‡ç­¾éœ€è¦é—­åˆ <input type="text" />ï¼Œç©ºæ ‡ç­¾å¯ä»¥ç›´æ¥è‡ªé—­åˆ <div /> -->
<script>
export default {
  data() {  // è¿™é‡Œå¿…é¡»æ˜¯å‡½æ•°å½¢å¼
    return {n:0}
  },
  methods: {
    add() {
      this.n++
    }
  }
}
</script>
<style>
div {
  color: #333;
}
</style>
```

`main.js` ä¸­

```js
import Xxx from './xxx.vue'  // Xxx æ˜¯ä¸€ä¸ª options å¯¹è±¡
new Vue({
  render: h => h(Xxx)
}).$mount('#app')
```

æ¨¡ç‰ˆä¸­çš„è¯­æ³•

#### (1) å±•ç¤ºå†…å®¹

å¯ä»¥ä½¿ç”¨**è¡¨è¾¾å¼**å±•ç¤º Vue ä¸­çš„å˜é‡ç­‰ `<div>è¡¨è¾¾å¼</div>`

- `{{object.a}}` è¡¨è¾¾å¼
- `{{n+1}}` å¯ä»¥å†™ä»»ä½•è¿ç®—
- `{{fn(n)}}` å¯ä»¥è°ƒç”¨å‡½æ•°

å¦‚æœå€¼ä¸º undefined æˆ– null å°±ä¸æ˜¾ç¤º

å¦ä¸€ç§å†™æ³•ä¸º `<div v-text="è¡¨è¾¾å¼"></div>`

**HTML** å†…å®¹

å¯ä»¥ç›´æ¥ä½¿ç”¨ `<div v-html="x"></div>`ï¼ˆx çš„å€¼ä¸º `<span>hi</span>`ï¼‰

**ä¸è¿›è¡Œç¼–è¯‘**ï¼Œå°±æ˜¾ç¤º `{{n}}`

`<div v-pre>{{n}}</div>`ï¼Œ`v-pre` ä¸ä¼šå¯¹æ¨¡æ¿è¿›è¡Œç¼–è¯‘

#### (2) ç»‘å®šå±æ€§

ç»‘å®š src `v-bind:å±æ€§å`

```html
<img v-bind:src="x" />
```

å¯ä»¥ç®€å†™ï¼š

```html
<img :src="x" />
```

ç»‘å®šå¯¹è±¡

```html
<div :style="{border: '1px solid red', height: 100}">æ–‡å­—</div>  <!-- '100px' å¯ä»¥å†™æˆ 100 -->
```

#### (3) ç»‘å®šäº‹ä»¶

`v-on:äº‹ä»¶å` ç»‘å®šäº‹ä»¶ï¼Œåé¢æ˜¯æ‰§è¡Œçš„ä»£ç æˆ–å‡½æ•°å

- `<button v-on:click="add">+1</button>` ç‚¹å‡»ä¹‹å Vue ä¼šè¿è¡Œ `add()`
- `<button v-on:click="xxx(1)">xxx</button>` ç‚¹å‡»ä¹‹å Vue ä¼šè¿è¡Œ `xxx(1)` ï¼ˆVue å¤„ç†äº†ï¼Œä¸ä¼šå†åŠ æ‹¬å·ï¼Œå¦‚æœéœ€è¦ï¼Œå¯ä»¥å…ˆèµ‹å€¼ x = xxx(1)ï¼Œç„¶åè¿™é‡Œå¡« xï¼‰
- `<button v-on:click="n+=1">+1</button>` ç‚¹å‡»ä¹‹å Vue ä¼šè¿è¡Œ `n+=1`

å¯ä»¥ç¼©å†™ä¸º `@äº‹ä»¶å`

```html
<button @click="add">+1</button>
```

#### (4) æ¡ä»¶åˆ¤æ–­

`v-if`ã€`v-else-if`ã€`v-else` è¡¨ç¤ºåˆ¤æ–­ï¼Œåªæœ‰æ»¡è¶³æ‰ä¼šå‡ºç°åœ¨ DOM æ ‘ä¸­

```html
<div v-if="x>0">x å¤§äº 0</div>
<div v-else-if="x===0">x ä¸º 0</div>
<div v-else>x å°äº 0</div>
```

#### (5) å¾ªç¯

`v-for` å¾ªç¯å…ƒç´ 

```html
<ul>
  <li v-for="(u, index) in users" :key="index">ç´¢å¼•ï¼š {{index}} å€¼ï¼š{{u.name}}</li>
</ul>
<ul>
  <li v-for="(value, name) in obj" :key="name">å±æ€§åï¼š{{name}} å±æ€§å€¼ï¼š{{name}}</li>
</ul>
```

`:key` å¿…é¡»å†™ï¼Œå¦åˆ™ä¼šæœ‰è­¦å‘Šï¼Œå€¼å¯ä»¥æ˜¯ `u.id` ç­‰ï¼ˆä¸ä¼šé‡åˆçš„å€¼ï¼‰

#### (6) æ˜¾ç¤ºã€éšè—

ä½¿ç”¨ `v-show` æ§åˆ¶å…ƒç´ çš„æ˜¾ç¤ºå’Œéšè—

```html
<div v-show="n%2===0">{{n}}</div>
```

è¿‘ä¼¼ç­‰äºï¼ˆ`display` å€¼ä¸ä¸€å®šä¸º `block`ï¼‰

```html
<div :style="{display: n%2===0 ? 'block' : 'none'}">{{n}}</div>
```

è¿˜æœ‰å››ä¸ªæŒ‡ä»¤

- `v-model`ï¼šè¡¨å•ä¸­
- `v-slot`ï¼šVue æ’æ§½
- `v-cloak`
- `v-once`

#### æŒ‡ä»¤ Directiveï¼ˆå‘½ä»¤ã€æŒ‡ç¤ºï¼‰

- åœ¨ Vue ä¸­ä»¥ `v-` å¼€å¤´çš„å°±æ˜¯æŒ‡ä»¤
- è¯­æ³•ï¼š
	- `v-æŒ‡ä»¤å:å‚æ•°=å€¼`ï¼Œä¾‹å¦‚ `v-on:click=add`
	- å¦‚æœå€¼é‡Œæ²¡æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œåˆ™å¯ä»¥ä¸åŠ å¼•å·
	- æœ‰äº›æŒ‡ä»¤æ²¡æœ‰å‚æ•°å’Œå€¼ï¼Œä¾‹å¦‚ `v-pre`
	- æœ‰äº›æŒ‡ä»¤æ²¡æœ‰å€¼ï¼Œä¾‹å¦‚ `v-on:click.prevent`ï¼ˆé˜»æ­¢é»˜è®¤äº‹ä»¶ï¼‰

#### ä¿®é¥°ç¬¦

- æœ‰äº›æŒ‡ä»¤æ”¯æŒä¿®é¥°ç¬¦
	- `@click.stop="add"` è¡¨ç¤ºé˜»æ­¢äº‹ä»¶ä¼ æ’­/å†’æ³¡
	- `@click.prevent="add"` è¡¨ç¤ºé˜»æ­¢é»˜è®¤åŠ¨ä½œ
	- `@click.stop.prevent="add"` åŒæ—¶è¡¨ç¤ºä¸Šé¢ä¸¤ç§
- ä¸€å…±æœ‰è¿™äº›ä¿®é¥°ç¬¦
	- `v-on` æ”¯æŒ
		- `.{keycode | keyAlias}`ï¼ˆ`<input @keypress.13="handdleEnter" />` å¯ä»¥åœ¨å®˜ç½‘æŸ¥çœ‹æŒ‰é”®ç ï¼‰ã€`.stop`ã€`.prevent`ã€`.capture`ã€`.self`ã€`.once`ã€`.passive`ã€`.native`
		- å¿«æ·é”®ç›¸å…³ `.ctrl`ã€`.alt`ã€`.shift`ã€`.meta`ã€`.exact`
		- é¼ æ ‡ç›¸å…³ `.left`ã€`.right`ã€`.middle`
	- `v-bind` æ”¯æŒ `.prop`ã€`.camel`ã€`.sync`
	- `v-model` æ”¯æŒ `.lazy`ã€`.number`ã€`.trim`

é‡ç‚¹äº†è§£ä¸€ä¸‹ `.sync` ä¿®é¥°ç¬¦

ç»„ä»¶ä¹‹é—´ä¿®æ”¹æ•°æ®çš„é—®é¢˜ï¼ŒVue æœ‰è¿™äº›è§„åˆ™ï¼š

- ç»„ä»¶ä¸èƒ½ä¿®æ”¹ props å¤–éƒ¨æ•°æ®
- `$emit` å¯ä»¥è§¦å‘äº‹ä»¶ï¼Œå¹¶ä¼ å‚
- `$event` å¯ä»¥è·å– `$emit` çš„å‚æ•°

```js
// main.js
import Vue from 'vue'
import App from './app.vue'
Vue.config.productionTip = false
new Vue({
  render: h => h(App)
}).$mount('#app')
```

App ç»„ä»¶ `app.vue`

```vue
<template>
  <div id="app">
    <div>App ç»„ä»¶ï¼šæ€»é‡ total ä¸º {{ total }}</div>
    <Child :num="total" />
  </div>
</template>

<script>
import Child from "./child.vue";

export default {
  name: "App",
  components: { Child },
  data() {
    return { total: 10000 };
  },
};
</script>

<style>
body {
  background: #f5f5f5;
}
#app {
  background: #fff;
  margin: 20px;
  padding: 20px;
  border-radius: 8px;
}
</style>
```

Child ç»„ä»¶ `child.vue`

```vue
<template>
  <div class="child">
    Child ç»„ä»¶ï¼šnum ä¸º {{ num }}
    <button @click="num -= 100">-100</button>
  </div>
</template>

<script>
export default {
  props: ["num"],
};
</script>

<style lang="scss">
.child {
  margin-top: 16px;
  padding: 20px;
  border: 1px solid rgba(0, 0, 0, 0.1);
  border-radius: 8px;
  button {
    margin-left: 8px;
  }
}
</style>
```

ç°åœ¨ Appã€Child ç»„ä»¶éƒ½å¯ä»¥æ˜¾ç¤ºæ€»é‡ï¼Œé€šè¿‡ props ä¼ è¿‡å»çš„ï¼Œç°åœ¨è®© num å‡ 100ï¼Œç‚¹å‡»ä¹‹åæ§åˆ¶å°æœ‰ä¸€ä¸ªçº¢è‰²è­¦å‘Šï¼Œå¹¶ä¸”å­ç»„ä»¶æ€»æ•° num å‡äº† 100ï¼Œä½†æ˜¯çˆ¶ç»„ä»¶ total å¹¶æ²¡æœ‰å‡å°‘

```

[Vue warn]: Avoid mutating a prop directly since the value will be overwritten whenever the parent component re-renders. Instead, use a data or computed property based on the prop's value. Prop being mutated: "num"

```

å¯ä»¥ä½¿ç”¨**è®¢é˜…å‘å¸ƒ**æ¥ä¿®æ”¹ï¼Œè€Œ Vue å†…ç½®äº†ä¸€å¥—è®¢é˜…å‘å¸ƒï¼Œé€šè¿‡ `$emit('å…³é”®è¯', è¡¨è¾¾å¼)` è¿›è¡Œå‘å¸ƒï¼Œ`v-on:å…³é”®è¯="è¡¨è¾¾å¼"` è®¢é˜…ç›‘å¬ï¼Œ`$event` è·å– `$emit` ä¼ çš„å‚æ•°

ä¿®æ”¹åçš„ä¸º

```vue
<!-- app.vue -->
<Child :num="total" v-on:update:num="total = $event" />  <!-- Vue ä¸­çº¦å®šå°±ç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸² update:xxx ä½œä¸ºå…³é”®è¯ -->

<!-- child.vue -->
<button @click="$emit('update:num', num - 100)">-100</button>
```

ç°åœ¨ç‚¹å‡»æŒ‰é’® num å’Œ total å°±ä¼šä¸€èµ·è¢«ä¿®æ”¹

`app.vue` ä¸­è¿™ä¸ªæ“ä½œå¾ˆå¸¸è§ï¼Œå› æ­¤ Vue æä¾›äº†ä¿®é¥°ç¬¦ `.sync`

```vue
<Child :num.sync="total" />
```

`:num.sync="total"` ç­‰ä»·äº `v-on:num="total" v-on:update:num="total = $event"`ï¼Œæ˜¯ä¸€ä¸ªè¯­æ³•ç³–

### 3ã€æŒ‡ä»¤ Directive

æŒ‡ä»¤çš„ä½œç”¨

- ä¸»è¦ç”¨äº DOM æ“ä½œ
	- Vue å®ä¾‹/ç»„ä»¶ç”¨äºæ•°æ®ç»‘å®šã€äº‹ä»¶ç›‘å¬ã€DOM æ›´æ–°
	- Vue æŒ‡ä»¤ä¸»è¦ç›®çš„å°±æ˜¯åŸç”Ÿ DOM æ“ä½œ
- å‡å°‘é‡å¤
	- å¦‚æœæŸä¸ª DOM æ“ä½œç»å¸¸ä½¿ç”¨ï¼Œå°±å¯ä»¥å°è£…ä¸ºæŒ‡ä»¤
	- å¦‚æœæŸä¸ª DOM æ“ä½œæ¯”è¾ƒå¤æ‚ï¼Œä¹Ÿå¯ä»¥å°è£…ä¸ºæŒ‡ä»¤

å‰é¢çš„ Vue æ¨¡ç‰ˆä¸­å·²ç»äº†è§£äº†ä¸€äº›å†…ç½®æŒ‡ä»¤ï¼š`v-if`ã€`v-for`ã€`v-show`ã€`v-html` ç­‰

é™¤äº†å†…ç½®æŒ‡ä»¤ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰æŒ‡ä»¤ï¼ˆè‡ªå·±é€ çš„æŒ‡ä»¤ï¼‰

(1) å£°æ˜ä¸€ä¸ªå…¨å±€æŒ‡ä»¤

```js
Vue.directive('x', directiveOpts)
```

å¯ä»¥åœ¨ä»»ä½•ç»„ä»¶é‡Œä½¿ç”¨ `v-x`

(2) å£°æ˜ä¸€ä¸ªå±€éƒ¨æŒ‡ä»¤

```js
new Vue({
  ...,
  directives: directiveOpts  // ä»»ä½•ä¸€ä¸ªæ„é€ é€‰é¡¹ä¸­
})
```

`v-x` å°±åªèƒ½åœ¨è¿™ä¸ªå®ä¾‹ä¸­ä½¿ç”¨

directiveOpts ä¸­äº”ä¸ªå‡½æ•°å±æ€§

```js
bind: function(el, info, vnode, oldVnode) {
  // äº”ä¸ªå‡½æ•°å‚æ•°ç›¸åŒ
} // ç±»ä¼¼ created
inserted: function(){}  //ç±»ä¼¼ mounted
update: function(){}  // ç±»ä¼¼ updated
componentUpdated: function(){}
unbind() {} // ç±»ä¼¼ destroyed
```

ğŸŒ° ä¾‹å­ä¸€ï¼šç‚¹å‡»æ‰“å°

```js
import Vue from "vue";
import App from "./App.vue";

Vue.config.productionTip = false;

// è‡ªå®šä¹‰ä¸€ä¸ª v-y æŒ‡ä»¤ï¼Œå½“ç‚¹å‡»å…ƒç´ çš„æ—¶å€™è¾“å‡º y
Vue.directive('y', {  // ä¸€ä¸ªæŒ‡ä»¤ï¼Œæ²¡æœ‰ s
  inserted: function(el) {
    el.addEventListener('click', ()=>{
      console.log('y')
    })
  }
})

new Vue({
  render: h => h(App)
}).$mount("#app");

// åªåœ¨ä¸€ä¸ªç»„ä»¶å†…ä½¿ç”¨
export default {
  data() {
    return {}
  },
  directives: {  // å¯ä»¥å£°æ˜å¤šä¸ªæŒ‡ä»¤
    x: {
      inserted: function(el) {
    el.addEventListener('click', ()=>{
      console.log('y')
    })
  }
    }
  }
}

// å…¶ä»–åœ°æ–¹ä½¿ç”¨
<template>
  <div v-y>Hello</div>
</template>
```

ğŸŒ° ä¾‹å­äºŒï¼šè‡ªå·±å®ç°ä¸€ä¸‹ç®€åŒ–ç‰ˆ v-on

```js
new Vue({
  directives: {
    on2: {
      inserted(el,info) {
        el.addEventListener(info.arg, info.value)
      },
      unbind(el, info) {  // å¥½ä¹ æƒ¯â€”â€”æ·»åŠ äº†åœ¨åˆé€‚åœ°æ–¹åˆ é™¤ï¼›å®šæ—¶å™¨ä¹Ÿä¸€æ ·ï¼Œç”¨äº†ä¹Ÿè¦è®°å¾—æ¸…é™¤
        el.removeEventListener(info.arg, info.value)
      }
    }
  },
  template: `<div>
    <button v-on2:click='hi'></button>
  </div>`,
  methods: {
    hi() {
      console.log('hi')
    }
  }
}).$mount('#app')
```

å‡½æ•°å¯ä»¥ç®€å†™ï¼Œä½†æ˜¯ä¸å¤ªå®ç”¨

### 4ã€æ··å…¥

mixins æ··å…¥å°±æ˜¯å¤åˆ¶

å‡å°‘é‡å¤

- æŒ‡ä»¤çš„ä½œç”¨æ˜¯å‡å°‘ DOM æ“ä½œçš„é‡å¤
- æ··å…¥çš„ä½œç”¨å°±æ˜¯å‡å°‘ dataã€methodsã€é’©å­çš„é‡å¤

ğŸŒ° ä¾‹å­ï¼šç»„ä»¶åœ¨ created çš„æ—¶å€™æ‰“å°

æ–°å»º `minxins/log.js`

```js
const log = {
  data() {
    return {
      name: undefined
    }
  },
  created() {
    if(this.name) {
      this.name = 'è¯¥ç»„ä»¶'
    }
    console.log(`${this.name}å‡ºç”Ÿäº†`)
  }
}
export log
```

ä½¿ç”¨çš„æ—¶å€™

```vue
<script>
import log from '../minxins/log.js'
export default {
  data() {
    return {
      name: 'ç»„ä»¶å'
    }
  }
  mixins: [log]
}
</script>
```

mixins ä¸­é€‰é¡¹ä¼š**æ™ºèƒ½åˆå¹¶**ï¼Œä¾‹å¦‚ data ä¸­çš„æ•°æ®

å…¨å±€

```js
Vue.mixin({
  data() {
    return {
      name: undefined
    }
  },
  created() {
    if(this.name) {
      this.name = 'è¯¥ç»„ä»¶'
    }
    console.log(`${this.name}å‡ºç”Ÿäº†`)
  }
})
```

### 5ã€ç»§æ‰¿

å…¨å±€ï¼Œåˆ›å»ºä¸€ä¸ª MyVue.js æ–‡ä»¶

```js
import Vue from 'vue'
export default cosnt MyVue = Vue.extend({
  // æˆ–è€…ç›´æ¥ import log.js å
  // minxins: [log]
  data() {
    return {
      name: undefined
    }
  },
  created() {
    if(this.name) {
      this.name = 'è¯¥ç»„ä»¶'
    }
    console.log(`${this.name}å‡ºç”Ÿäº†`)
  }
})
```

å…¶ä»–æ–‡ä»¶

```vue
<script>
import MyVue from '../MyVue.js'
export default {
  data() {
    return {
      name: 'ç»„ä»¶å'
    }
  },
  extends: MyVue
}
</script>
```

main.js ä¹Ÿå¯ä»¥ç›´æ¥ç”¨ MyVue

```js
import Vue from 'vue'
import MyVue from './MyVue'
new MyVue({
  data() {
    return { name: 'Main' }
  },
  render: h => h(App)
}).$mount('#app')
```

extends æ˜¯æ¯” mixins æ›´æŠ½è±¡çš„å°è£…ï¼Œå¦‚æœéœ€è¦å†™å¤šæ¬¡ mixinsï¼Œåˆ™å¯ä»¥è€ƒè™‘ä½¿ç”¨ extends

### 6ã€æä¾›ã€æ³¨å…¥

provide å’Œ inject ä¸€èˆ¬æ­é…ä½¿ç”¨

å‰äººæ ½æ ‘ï¼ˆprovideï¼‰ã€åäººä¹˜å‡‰ï¼ˆinjectï¼‰

è¯­æ³•ï¼š

```js
// ä¼ å‡ºçš„æ–‡ä»¶ä¸­ æ„é€ é€‰é¡¹
provide() {
  return {
    value: this.value,
    fn: this.fn
  }
}
// ä¼ å…¥çš„æ–‡ä»¶ä¸­ æ„é€ é€‰é¡¹
inject: ['value', 'fn']
// ä¹‹åå°±å¯ä»¥ä½¿ç”¨ value å˜é‡å’Œ fn å‡½æ•°äº†
```

ä¾‹å¦‚ï¼šæ¢è‚¤ç»„ä»¶

App.vue æ–‡ä»¶

```vue
<template>
  <div
    id="app"
    :class="`theme-${color}`"
    :style="{ fontSize: fontSize + 'px' }"
  >
    <h1><span class="primary">æ¸è¿›å¼</span>JavaScript æ¡†æ¶</h1>
    <h2>
      å½“å‰ä¸»é¢˜è‰²ï¼š<span class="primary">{{ color }}</span>
    </h2>
    <h2>
      å½“å‰å­—ä½“å¤§å°ï¼š<span class="primary">{{ fontSize }} px</span>
    </h2>
    <ChangeTheme />
  </div>
</template>

<script>
import ChangeTheme from "./components/changeTheme.vue";

export default {
  name: "App",
  components: { ChangeTheme },
  provide() {
    return {
      fontSize: this.fontSize,
      color: this.color,
      changeSize: this.changeSize,
      changeColor: this.changeColor,
    };
  },
  data() {
    return {
      fontSize: 16,
      color: "default",
    };
  },
  methods: {
    changeSize(value) {
      console.log(value);
      if (value !== undefined) {
        this.fontSize += value;
      } else {
        this.fontSize = 16;
      }
    },
    changeColor() {
      if (this.color === "defualt") {
        this.color = "red";
      } else if (this.color === "red") {
        this.color = "blue";
      } else {
        this.color = "defualt";
      }
    },
  },
};
</script>

<style lang="scss">
body {
  background-color: #f5f5f5;
}
#app {
  text-align: center;
  --primary: #333;
  &.theme-blue {
    --primary: #1055d4;
  }
  &.theme-red {
    --primary: #d41010;
  }
  .primary {
    color: var(--primary);
  }
  button {
    font-size: inherit;
    background-color: var(--primary);
    color: #fff;
    border: none;
    border-radius: 3px;
    margin: 0 0.8em;
    padding: 0.3em 1em;
    cursor: pointer;
  }
}
</style>
```

`./components/changeTheme.vue` æ–‡ä»¶

```vue
<template>
  <div class="change-wrap">
    <h2>
      è·å–åˆ°çš„ä¸»é¢˜è‰²ï¼š<span class="primary">{{ color }}</span>
    </h2>
    <button @click="changeColor">ä¿®æ”¹ä¸»é¢˜è‰²</button>
    <h2>
      è·å–åˆ°çš„å­—ä½“å¤§å°ï¼š<span class="primary">{{ fontSize }} px</span>
    </h2>
    <button @click="changeSize(1)">æ”¾å¤§</button
    ><button @click="changeSize()">æ­£å¸¸</button
    ><button @click="changeSize(-1)">ç¼©å°</button>
  </div>
</template>

<script>
export default {
  inject: ["fontSize", "color", "changeSize", "changeColor"],
};
</script>

<style>
.change-wrap {
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  padding: 20px;
  min-width: 90%;
  background-color: #fff;
  border-radius: 8px;
  border: 1px solid var(--primary);
}
</style>
```

æ€»ç»“

- ä½œç”¨ï¼šå¤§èŒƒå›´çš„ data å’Œ method ç­‰å…±ç”¨
- æ³¨æ„ï¼šä¸èƒ½åªä¼  color ä¸ä¼  changeColorï¼Œå› ä¸º color çš„å€¼æ˜¯è¢«å¤åˆ¶ç»™ provide çš„
- å°½ç®¡å¯ä»¥ä½¿ç”¨å¯¹è±¡å±æ€§ï¼ˆä¼ åœ°å€ï¼‰ï¼Œä½†æ˜¯ä¸æ¨èï¼Œä¼šå®¹æ˜“å¤±æ§
