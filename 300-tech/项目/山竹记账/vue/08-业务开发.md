---
title: 08-业务开发
date: 2024-05-17T10:13:00+08:00
updated: 2024-08-21T10:33:33+08:00
dg-publish: false
---

完成其他页面

> 做业务会把人做废了

建议：在业务中寻找**轮子**来造

> 不要重复造轮子

可以不造，但是不能不会，否则看不懂源码

> 应该用 AntDesign 等第三方 UI 库

大部分不满足设计要求，基于 AntD 做**二次封装**，使其更满足公司的需求

> 编程的阶段：新手学习怎么**用**轮子（消费者）→ 老手学习怎么**造**轮子（生产者）

在新手阶段多用轮子

> 造轮子的好处（大公司晋升秘笈）

1. **学习**新的开源轮子
2. 在项目中**使用**开源轮子
3. **发现**不适合公司业务的地方
4. **缝合**出一套更适合公司业务的轮子
5. 在公司导出**宣扬**开源轮子的弊端
6. **推广**使用自己的轮子
7. **晋升**
8. 回到第一步，继续学习另一个开源轮子

> 什么样的开源轮子值得使用

壹个人持续维护三年以上的

## Button 组件

```tsx
import {defineComponent} from "vue"
import s from './Button.module.scss'

export default defineComponent({
  setup(_, context) {
    return () => (
      <button class={s.button}>
        {context.slots.default?.()}
      </button>
    )
  },
})
```

给默认样式，其他引入的地方也能进行覆盖

```scss
.button {  
  cursor: pointer;  
  outline: none;  
  border: 1px solid transparent;  
  padding: .4em 1em;  
  font-size: .9rem;  
  background-color: var(--primary);  
  color: var(--white);  
  &:hover {  
    opacity: .8;  
  }  
  &:active {  
    filter: light(50%);  
  }  
}
```

直接在页面中使用

```tsx
import {defineComponent} from "vue"
import Button from "../components/Button"
import s from './Start.module.scss'

export default defineComponent({
  setup() {
    const onClick = () => {
      console.log('hi')
    }
    // 居然能直接使用 onClick
    return () => (
      <div class={s.wrapper}>
        <div class={s.logo}>
          <span>Money</span>
        </div>
        <div class={s.text}>
          <p>一个管理你的小账本</p>
        </div>
        <Button class={s.btn} onClick={onClick}> 测试 </Button>
      </div>
    )
  },
})
```

覆盖样式

```scss
.wrapper {  
  padding: 0 var(--gap);  
  
  .btn {  
    width: 100%;  
    padding: 0.6rem 0;  
    border-radius: 0.4rem;  
  }  
}
```

Vue 3 认为在组件上用 `onClick` 的意思就是需要直接绑定到组件上，所以不需要手动声明

不想绑定可以声明 `inheritAttrs`，然后自己写

```tsx
import {defineComponent} from "vue"
import s from './Button.module.scss'

export default defineComponent({
  setup(props, context) {
    inheritAttrs: false,
    props: ['class', 'onClick']
    return () => (
      <button class={[s.button, props.class]} onClick={props.onClick}>
        {context.slots.default?.()}
      </button>
    )
  },
})
```

外面使用 `onClick` 的时候，TS 检查会说没有声明（Vue 默认声明了 class 和 style），所以手动声明下

```tsx
import {defineComponent} from "vue"
import s from './Button.module.scss'

interface Props {  
  onClick?: (e: MouseEvent) => void  
}

// 这种 Props
export default defineComponent<Props>({
  setup(_, context) {
    return () => (
      <button class={s.button}>
        {context.slots.default?.()}
      </button>
    )
  },
})
```

## FloatButton 组件

```tsx
import {defineComponent} from "vue"  
import Icon from "./Icon"  
import s from './FloatButton.module.scss'  
  
interface Props {  
  iconName: string  
  onClick?: (e: MouseEvent) => void  
}  

// props 显式写上才能用
export default defineComponent({  
  props: {
    iconName: {
      type: String as PropType<string>,
      required: true
    }
  },  
  setup(props: Props) {  
    return () => (  
      <button class={s.floatBtn}>  
        <Icon width="2.5rem" height="2.5rem" name={props.iconName} />  
      </button>    )  
  },  
})

// 样式如下
.floatBtn {  
  position: fixed;  
  bottom: calc(var(--gap) + .3rem);  
  right: var(--gap);  
  display: flex;  
  justify-content: center;  
  align-items: center;  
  width: 3.8rem;  
  height: 3.8rem;  
  border-radius: 50%;  
  background: var(--primary);  
  color: var(--white);  
  transition: all 0.3s;  
}
```

props 中的变量如果用的就不会自动绑定到最外层

使用

```tsx
<FloatButton iconName="add" />
```

## Center 组件

```tsx
import {defineComponent, PropType} from "vue"  
import s from './Center.module.scss'  
  
const directionMap = {  
  '-': 'horizontal',  
  '|': 'vertical',  
  'horizontal': 'horizontal',  
  'vertical': 'vertical'  
}  
  
export default defineComponent({  
  props: {  
    direction: {  
      type: String as PropType<'-' | '|' | 'horizontal' | 'vertical'>,  
      default: 'horizontal'  
    }  
  },  
  setup(props, context) {  
    const extraClass = directionMap[props.direction]  
    return () => (  
      <div class={[s.center, s[extraClass]]}>  
        {context.slots.default?.()}  
      </div>  
    )  
  },  
})

// 样式
.center {  
  display: flex;  
  align-items: center;  
  justify-content: center;  
  &.horizontal {  
    flex-direction: row;  
  }  
  &.vertical {  
    flex-direction: column;  
  }  
}
```

使用

```tsx
<Center class={s.center}>  
  <Icon name="pig" width="128" height="128" class={s.icon} />  
</Center>
```

## Navbar 组件

```tsx
import { defineComponent, PropType } from 'vue';
import s from './Navbar.module.scss';
export const Navbar = defineComponent({
  props: {
    name: {
      type: String as PropType<string>
    }
  },
  setup: (props, context) => {
    const {slots} = context
    return () => (
      <div class={s.navbar}>
        <span class={s.icon_wrapper}>
          {slots.icon?.()}
        </span>
        <span class={s.title_wrapper}>
          {slots.default?.()}
        </span>
      </div>
    )
  }
})
```

可以传参数

```tsx
<Navbar>{
  {
    default: () => '菠萝记账',
    icon: () => <Icon name="menu" class={s.navIcon} onClick={onClickMenu} />
  }
}</Navbar>
```

## Overlay 组件

```tsx
import {defineComponent, PropType} from "vue"  
import s from './Overlay.module.scss'  
import Icon from "./Icon"  
  
export default defineComponent({  
  props: {  
    onClose: {  
      type: Function as PropType<(e: MouseEvent) => void>,  
      required: false  
    }  
  },  
  setup(props, _) {  
    return () => (  
      <div class={s.wrapper}>  
        <div class={s.overlay}>  
          <header>            <h2>未登录用户</h2>  
            <p>点击这里登录</p>  
          </header>          <nav>            <ul>              <li><Icon name="charts" class={s.icon} /> 统计图表</li>  
              <li><Icon name="export" class={s.icon} /> 导出数据</li>  
              <li><Icon name="tags" class={s.icon} /> 修改标签</li>  
              <li><Icon name="alarm" class={s.icon} /> 记账提醒</li>  
            </ul>          </nav>        </div>        <div class={s.mask} onClick={props.onClose}></div>  
      </div>    )  
  },  
})
```

样式

```scss
.wrapper {  
  position: fixed;  
  left: 0;  
  top: 0;  
  right: 0;  
  bottom: 0;  
  .overlay {  
    position: relative;  
    width: 70%;  
    min-width: 14em;  
    height: 100%;  
    background: var(--white);  
    z-index: calc(var(--overay-mask-index) + 1);  
    > header {  
      padding: calc(var(--gap) * 2.5) var(--gap);  
      background: var(--gradient-start-color);  
      color: var(--white);  
      h2 {  
        font-size: 1.5rem;  
        margin-bottom: .8rem;  
      }  
      p {  
        font-size: 1rem;  
        opacity: .6;  
      }  
    }  
    > nav {  
      padding: calc(var(--gap) * 2) var(--gap);  
      font-size: 1.4rem;  
      font-weight: normal;  
      color: var(--black);  
      ul {  
        display: flex;  
        flex-direction: column;  
        gap: 1.6em;  
        li {  
          display: flex;  
          align-items: center;  
          gap: .5em;  
          svg {  
            font-size: 1.4em;  
          }  
        }  
      }  
    }  
  }  
  .mask {  
    position: absolute;  
    top: 0;  
    right: 0;  
    width: 100%;  
    height: 100%;  
    background-color: var(--overlay-mask-bg);  
    z-index: var(--overay-mask-index);  
  }  
}
```

使用

```tsx
const overlayVisible = ref(false)  
const showOverlay = () => {  
  overlayVisible.value = true  
} 
<Navbar onClick={showOverlay}>  
  {{  
    default: () => '菠萝记账',  
    icon: () => <Icon name="menu" class={s.icon} />  
  }}  
</Navbar>  

{  
  overlayVisible.value &&  
  <Overlay onClose={() => overlayVisible.value = false} />  
}  
```

关闭可以使用 emit，使用的时候还是一样 onClose

```tsx
onClick = {context.emit('close')}
```

## Tabs 组件

### 准备需要的路由

`routes.ts`

```ts
import Items from '../views/items/Items'  
import ItemList from '../views/items/ItemList'  
import ItemCreate from '../views/items/ItemCreate'

routes = [
  //...
  {  
    path: '/items',  
    component: Items,  
    children: [  
      { path: '', component: ItemList },  
      { path: 'create', component: ItemCreate },  
    ]  
  },
]
```

新建 `views/items/Items.tsx`，放子路由的容器

```tsx
import {defineComponent} from "vue"  
import {RouterView} from "vue-router"  
  
export default defineComponent({  
  setup() {  
    return () => (  
      <div>  
        <RouterView />      </div>    )  
  },  
})
```

新建子路由文件 `views/items/ItemList.tsx` 和 `views/items/ItemCreate.tsx`

```tsx
import {defineComponent} from "vue"  
  
export default defineComponent({  
  setup() {  
    return () => (  
      <div>  
        List  
      </div>  
    )  
  },  
})
```

### MainLayout 组件

```tsx
import {defineComponent, PropType} from "vue"  
import Navbar from "../Navbar"  
  
export default defineComponent({  
  props: {  
    onNavClick: {  
      type: Function as PropType<(e: MouseEvent) => void>,  
      required: false  
    }  
  },  
  setup(props, {slots}) {  
    return () => (  
      <div>  
        <Navbar onClick={props.onNavClick}>  
          {{  
            default: () => slots.title?.(),  
            icon: () => slots.icon?.(),  
          }}  
        </Navbar>  
        {slots.default?.()}  
      </div>  
    )  
  },  
})
```

使用

```tsx
export default defineComponent({  
  setup() {  
    const overlayVisible = ref(false)  
    const showOverlay = () => {  
      overlayVisible.value = true  
    }  
    const onClick = () => {  
      console.log('hi')  
    }  
    return () => (  
      <div class={s.wrapper}>  
        <MainLayout onNavClick={showOverlay}>{  
          {  
            title: () => '菠萝记账',  
            icon: () => <Icon name="menu" width="1.2em" height="1.2em" class={s.icon}/>,  
            default: () => <>  
              <Center class={s.center}>  
                <Icon name="pineapple" width="148" height="148" class={s.icon}/>  
              </Center>              <RouterLink to="/items/create">  
                <Button class={s.btn} onClick={onClick}>开始记账</Button>  
              </RouterLink>            </>          }  
        }</MainLayout>  
        <RouterLink to="/items/create">  
          <FloatButton iconName="add"/>  
        </RouterLink>        {  
          overlayVisible.value &&  
          <Overlay onClose={() => overlayVisible.value = false}/>  
        }  
      </div>  
    )  
  },  
})
```

### 设计 Tabs 接口（怎么用）

```tsx
import {defineComponent, ref} from "vue"
import Icon from "../../components/Icon"
import MainLayout from "../../components/layouts/MainLayout"
import {Tabs, Tab} from "../../components/Tabs"

export default defineComponent({
  setup() {
    const kind = ref('支出')
    const onUpdateSelected = (name: string) => {
      kind.value = name
    }
    return () => (
      <div>
        <MainLayout>{
          {
            title: () => '记一笔',
            icon: () => <Icon name="left" width="1em" height="1em" />,
            default: () => <>
              <Tabs selected={kind.value} onUpdateSelected={onUpdateSelected}>
                <Tab name="支出">
                  支出页面
                </Tab>
                <Tab name="收入">
                  收入页面
                </Tab>
              </Tabs>
            </>
          }
        }</MainLayout>
      </div>
    )
  },
})
```

### 实现 Tabs 组件功能

```tsx
import {defineComponent, Teleport} from "vue"
import s from './Tabs.module.scss'

export const Tab = defineComponent({
  props: {
    name: {
      type: String,
      required: true,
    },
  },
  setup(_, {slots}) {
    return () => <div>{slots.default?.()}</div>
  },
})

export const Tabs = defineComponent({
  props: {
    selected: {
      type: String,
      required: true,
    },
  },
  setup(props, {slots, emit}) {
    return () => {
      const tabs = slots.default?.()
      if (!tabs) return null
      for (let i = 0; i < tabs.length; i++) {
        if (tabs[i].type !== Tab) {
          throw new Error('Tabs 的子组件应该是 Tab')
        }
      }
      return (<nav class={s.tabs}>
        <ul>
          {tabs.map(node => node.props &&
            <li
              class={props.selected === node.props.name ? s['selected'] : ''}
              onClick={() => emit('update:selected', node.props?.name)}
            >
              {node.props.name}
            </li>)}
        </ul>
        <Teleport to='#app'> {/* 可以把这个元素穿透到另外一个元素下，to 里可写选择器 */}
          <div class={s.teleport}>
            {/* 发现元素 i 的 children.default 就是需要的内容，接着发现 {tabs} 可以直接渲染出所有内容那可以用 filter 或 find 找到这个元素， */}
            {tabs.find(node => node.props?.name === props.selected)}
          </div>
        </Teleport>
      </nav>)
    }
  },
})

////////////////// 完整版如下 /////////////////////

import {defineComponent, Teleport} from "vue"
import s from './Tabs.module.scss'

export const Tab = defineComponent({
  props: {
    name: {
      type: String,
      required: true,
    },
  },
  setup(_, {slots}) {
    return () => <div>{slots.default?.()}</div>
  },
})

export const Tabs = defineComponent({
  emits: ['update:selected'],
  props: {
    selected: {
      type: String,
      required: true,
    },
  },
  setup(props, {slots, emit}) {
    return () => {
      const tabs = slots.default?.()
      if (!tabs) return null
      for (let i = 0; i < tabs.length; i++) {
        if (tabs[i].type !== Tab) {
          throw new Error('Tabs 的子组件应该是 Tab')
        }
      }
      return (<nav class={s.tabs}>
        <ul>
          {tabs.map(node => node.props &&
            <li
              class={props.selected === node.props.name ? s['selected'] : ''}
              onClick={() => emit('update:selected', node.props?.name)}
            >
              {node.props.name}
            </li>)}
        </ul>
        <Teleport to='#app'>
          <div class={s.teleport}>
            {tabs.find(node => node.props?.name === props.selected)}
          </div>
        </Teleport>
      </nav>)
    }
  },
})

```

完整使用（修改了一下 Navbar 和 MainLayout）

```tsx
import {defineComponent, ref} from "vue"  
import Icon from "../../components/Icon"  
import MainLayout from "../../components/layouts/MainLayout"  
import {Tabs, Tab} from "../../components/Tabs"  
import {useRouter} from "vue-router";  
  
export default defineComponent({  
  setup() {  
    const router = useRouter()  
    const kind = ref('支出')  
    return () => (  
      <MainLayout onNavClick={() => router.back()}>{  
        {  
          title: () => '记一笔',  
          icon: () => <Icon name="left" width="1em" height="1em" />,  
          other: () => <>  
            <Tabs selected={kind.value} onUpdateSelected={name => kind.value = name}>  
              <Tab name="支出">  
                支出页面  
              </Tab>  
              <Tab name="收入">  
                收入页面  
              </Tab>  
            </Tabs>          </>        }  
      }</MainLayout>  
    )  
  },  
})
```

可以改用 v-model

```tsx
<Tabs selected={kind.value} v-model:selected={kind.value}>

<li  
  class={props.selected === node.props.name ? s['selected'] : ''}  
  onClick={() => emit('update:selected', node.props?.name)}  
>
```

## InputPad 组件

### 实现基础布局

```tsx
import {defineComponent} from "vue"
import Icon from "./Icon"
import s from './InputPad.module.scss'

export default defineComponent({
  setup(props, context) {
    const buttons = [
      {text: '1', onClick: () => {}},
      {text: '2', onClick: () => {}},
      {text: '3', onClick: () => {}},
      {text: 'DEL', onClick: () => {}},
      {text: '4', onClick: () => {}},
      {text: '5', onClick: () => {}},
      {text: '6', onClick: () => {}},
      {text: '-', onClick: () => {}},
      {text: '7', onClick: () => {}},
      {text: '8', onClick: () => {}},
      {text: '9', onClick: () => {}},
      {text: '+', onClick: () => {}},
      {text: '清空', onClick: () => {}},
      {text: '0', onClick: () => {}},
      {text: '.', onClick: () => {}},
      {text: '保存', onClick: () => {}},
    ]
    return () => (
      <div class={s.wrapper}>
        <header class={s.timeAndAmount}>
          <div class={s.time}>
            <Icon class={s.icon} name="date"/>
            <span>2020-01-01</span>
          </div>
          <div class={[s.amount, s.expense]}>123456789.00</div>
        </header>
        <main>
          {buttons.map(({text, onClick}) => (<button onClick={onClick}>{text}</button>))}
        </main>
      </div>
    )
  },
})
```

样式

```scss
.wrapper {
  padding: var(--gap);
  background: var(--white);

  > header.timeAndAmount {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-bottom: var(--gap);

    .time {
      display: flex;
      align-items: center;
      gap: .4rem;
      font-size: 1.1rem;
      color: var(--tips-text);

      .icon {
        font-size: 1.6rem;
      }
    }

    .amount {
      font-family: var(--font-number);
      font-size: 1.6rem;
      font-weight: bold;

      &.income {
        color: var(--income);
      }

      &.expense {
        color: var(--expense);
      }
    }
  }

  > main {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: repeat(4, 1fr);
    gap: .5rem;

    > button {
      padding: .8rem 0;
      font-size: 1rem;
      border-radius: .5rem;

      &:nth-child(16) {
        background: var(--primary);
        color: var(--white);
      }
    }
  }
}
```

### 封装时间库

现有时间库：

- Moment.js
- **dayjs**

自己写 暂时只需要格式化时间功能

```ts
const time = (date = new Date()) => {  
  const api = {  
    /**  
     * 格式化时间  
     * @param pattern<string> YYYY MM DD HH mm ss  
     * @returns string  
     * @example time.format('YYYY-MM-DD HH:mm:ss')  
     */    format: (pattern = 'YYYY-MM-DD HH:mm:ss') => {  
      const year = date.getFullYear()  
      const month = date.getMonth() + 1  
      const day = date.getDate()  
      const hour = date.getHours()  
      const minute = date.getMinutes()  
      const second = date.getSeconds()  
      return pattern  
        .replace(/YYYY/g, year.toString())  
        .replace(/YY/g, year.toString().slice(-2))  
        .replace(/MM/g, month.toString().padStart(2, '0'))  
        .replace(/DD/g, day.toString().padStart(2, '0'))  
        .replace(/HH/g, hour.toString().padStart(2, '0'))  
        .replace(/mm/g, minute.toString().padStart(2, '0'))  
        .replace(/ss/g, second.toString().padStart(2, '0'))  
    }  
  }  
  return api  
}  
  
export default time
```

### 使用 vant 实现选择时间

[快速上手 - Vant 4 (vant-ui.github.io)](https://vant-ui.github.io/vant/#/zh-CN/quickstart)

安装

```sh
pnpm add vant
```

使用手动引入方式

```tsx
import {Button} from "vant"  
import 'vant/lib/button/style/index.js'

<Button type="primary">按钮</Button>
```

代码

```tsx
import {defineComponent, ref} from "vue"
import Icon from "./Icon"
import time from '../shared/time'
import s from './InputPad.module.scss'
import {DatetimePicker, Popup} from "vant"
import 'vant/lib/datetime-picker/style/index.js'
import 'vant/lib/popup/style/index'

export default defineComponent({
  setup() {
    const buttons = [
      {text: '1', onClick: () => {}},
      {text: '2', onClick: () => {}},
      {text: '3', onClick: () => {}},
      {text: 'DEL', onClick: () => {}},
      {text: '4', onClick: () => {}},
      {text: '5', onClick: () => {}},
      {text: '6', onClick: () => {}},
      {text: '-', onClick: () => {}},
      {text: '7', onClick: () => {}},
      {text: '8', onClick: () => {}},
      {text: '9', onClick: () => {}},
      {text: '+', onClick: () => {}},
      {text: '清空', onClick: () => {}},
      {text: '0', onClick: () => {}},
      {text: '.', onClick: () => {}},
      {text: '保存', onClick: () => {}},
    ]
    const dataPickerVisible = ref(false)
    const showDataPicker = () => dataPickerVisible.value = true
    const hideDataPicker = () => dataPickerVisible.value = false
    const setTime = (value: Date) => {
      date.value = value
      hideDataPicker()
    }
    const now = new Date()
    const date = ref<Date>(now)
    const formatter = (type: string, val: string) => {
      if (type === 'year') {
        return val + '年'
      } else if (type === 'month') {
        return val + '月'
      } else if (type === 'day') {
        return val + '日'
      } else if (type === 'hour') {
        return val + '时'
      } else if (type === 'minute') {
        return val + '分'
      }
      return val
    }
    return () => (
      <div class={s.wrapper}>
        <header class={s.timeAndAmount}>
          <div onClick={showDataPicker} class={s.time}>
            <Icon class={s.icon} name="date"/>
            <span>{time(date.value).format('MM.DD')}</span>
          </div>
          <Popup position="bottom" v-model:show={dataPickerVisible.value}>
            <DatetimePicker value={date.value} title="选择时间" formatter={formatter}
              onConfirm={setTime}
              onCancel={hideDataPicker}
            />
          </Popup>
          <div class={s.note}>
            <input type="text" placeholder="点击这里输入备注" />
          </div>
          <div class={[s.amount, s.expense]}>￥16789.00</div>
        </header>
        <main>
          {buttons.map(({text, onClick}) => (<button onClick={onClick}>{text}</button>))}
        </main>
      </div>
    )
  },
})
```

### 实现输入数字功能

砍需求，不需要加减

```tsx
import {defineComponent, ref} from "vue"
import Icon from "./Icon"
import time from '../shared/time'
import s from './InputPad.module.scss'
import {DatetimePicker, Popup} from "vant"
import 'vant/lib/datetime-picker/style/index.js'
import 'vant/lib/popup/style/index'

export default defineComponent({
  setup() {
    const dataPickerVisible = ref(false)
    const showDataPicker = () => dataPickerVisible.value = true
    const hideDataPicker = () => dataPickerVisible.value = false
    const setTime = (value: Date) => {
      date.value = value
      hideDataPicker()
    }
    const now = new Date()
    const date = ref<Date>(now)
    const formatter = (type: string, val: string) => {
      if (type === 'year') {
        return val + '年'
      } else if (type === 'month') {
        return val + '月'
      } else if (type === 'day') {
        return val + '日'
      } else if (type === 'hour') {
        return val + '时'
      } else if (type === 'minute') {
        return val + '分'
      }
      return val
    }
    const amount = ref('0.00')
    const appendText = (n: string | number) => {
      // 1. 当前金额大于13位不能再输入
      if (amount.value.length >= 13) return
      // 2. 已经有小数点，不能再输入小数点
      if (amount.value.includes('.') && n === '.') return
      const nString = n.toString()
      const dotIndex = amount.value.indexOf('.')
      // 0开头的时候
      // 3.1 不能输入0
      // 3.2 输入小数点后正常输入
      // 3.3 输入其他数字，直接替换
      if (amount.value.startsWith('0')) {
        if (amount.value.length === 1 && nString === '0') return
        if (nString === '.') {
          amount.value += '.'
          return
        } else if (nString !== '0' && dotIndex === -1) {
          amount.value = nString
          return
        }
      }
      if (amount.value === '0.00') {
        amount.value = nString
      } else {
        // 小数点位数不能超过两位
        if (amount.value.includes('.')) {
          const decimal = amount.value.split('.')[1]
          if (decimal && decimal.length === 2) {
            return
          }
        }
        amount.value += nString
      }
    }
    const deleteText = () => {
      if (amount.value.length === 1) {
        amount.value = '0.00'
        return
      }
      amount.value = amount.value.slice(0, -1)
    }
    const buttons = [
      {text: '1', onClick: () => {appendText(1)}},
      {text: '2', onClick: () => {appendText(2)}},
      {text: '3', onClick: () => {appendText(3)}},
      {text: 'DEL', onClick: () => {deleteText()}},
      {text: '4', onClick: () => {appendText(4)}},
      {text: '5', onClick: () => {appendText(5)}},
      {text: '6', onClick: () => {appendText(6)}},
      {text: '7', onClick: () => {appendText(7)}},
      {text: '8', onClick: () => {appendText(8)}},
      {text: '9', onClick: () => {appendText(9)}},
      {text: '保存', onClick: () => {console.log(amount.value)}},
      {text: '清空', onClick: () => {amount.value = '0.00'}},
      {text: '0', onClick: () => {appendText(0)}},
      {text: '.', onClick: () => {appendText('.')}},
    ]
    return () => (
      <div class={s.wrapper}>
        <header class={s.timeAndAmount}>
          <div onClick={showDataPicker} class={s.time}>
            <Icon class={s.icon} name="date"/>
            <span>{time(date.value).format('MM.DD')}</span>
          </div>
          <Popup position="bottom" v-model:show={dataPickerVisible.value}>
            <DatetimePicker value={date.value} title="选择时间" formatter={formatter}
              onConfirm={setTime}
              onCancel={hideDataPicker}
            />
          </Popup>
          <div class={s.note}>
            <input type="text" placeholder="点击这里输入备注" />
          </div>
          <div class={[s.amount, s.expense]}>￥{amount.value}</div>
        </header>
        <main>
          {buttons.map(({text, onClick}) => (<button onClick={onClick}>{text}</button>))}
        </main>
      </div>
    )
  },
})
```

修改后样式

```scss
.wrapper {
  padding: var(--gap);
  background: var(--white);

  > header.timeAndAmount {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-bottom: var(--gap);

    .time {
      display: flex;
      align-items: center;
      gap: .4rem;
      font-size: 1.1rem;
      color: var(--tips-text);

      .icon {
        font-size: 1.6rem;
      }
    }

    .note {
      position: absolute;
      right: 0;
      left: 6rem;
      z-index: 1;
    }

    .amount {
      position: relative;
      z-index: 2;
      font-family: var(--font-number);
      font-size: 1.6rem;
      font-weight: bold;
      text-align: right;
      background: var(--white);

      &.income {
        color: var(--income);
      }

      &.expense {
        color: var(--expense);
      }
    }
  }

  > main {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    grid-template-rows: repeat(4, 1fr);
    gap: .5rem;

    > button {
      padding: .8rem 0;
      font-size: 1rem;
      border-radius: .5rem;

      &:nth-child(4) {
        grid-row: 1 / span 2;
        grid-column: 4 / span 1;
      }

      &:nth-child(11) {
        grid-row: 3 / span 2;
        grid-column: 4 / span 1;
        background: var(--primary);
        color: var(--white);
      }
    }
  }
}
```

## Emoji 组件

### 使用 JS 爬取需要的数据

直接搜 emoji full list，例如 [Emoji List, v12.0 (unicode.org)](https://unicode.org/emoji/charts-12.0/emoji-list.html)

等待页面加载完成

使用控制台检查元素，获取相应的数据

```js
const trs = document.querySelector('table').querySelectorAll('tr')
const trArr = Array.from(trs)
const result = []
trArr.map(tr => {
    const first = tr.children[0]
    const second = tr.children[1]
    if(first.classList.contains('mediumhead')) {
        console.log(first, '分类')
    } else if (first.classList.contains('rchars')){
        if(first.tagName.toLowerCase() === 'th'){
            console.log('表头')
        } else {
            const last = result[result.length-1]
            last[1] = last[1] || []
            last[1].push(second.textContent)
            console.log(second, '数据')
        }
    }
})
```

正则替换 `U\+([0-9a-f]{4,5})` → `\\u($1)`

以下是获取到的 v12 的数据

```ts
type EmojiList = [string, string[]][];
export const emojiList: EmojiList = [
  ["face-smiling", ["\u{1F600}", "\u{1F603}", "\u{1F604}", "\u{1F601}", "\u{1F606}", "\u{1F605}", "\u{1F923}", "\u{1F602}", "\u{1F642}", "\u{1F643}", "\u{1F609}", "\u{1F60A}", "\u{1F607}",],],
  ["face-affection", ["\u{1F970}", "\u{1F60D}", "\u{1F929}", "\u{1F618}", "\u{1F617}", "\u{263A}", "\u{1F61A}", "\u{1F619}",],],
  ["face-tongue", ["\u{1F60B}", "\u{1F61B}", "\u{1F61C}", "\u{1F92A}", "\u{1F61D}", "\u{1F911}",],],
  ["face-hand", ["\u{1F917}", "\u{1F92D}", "\u{1F92B}", "\u{1F914}"]],
  ["face-neutral-skeptical", ["\u{1F910}", "\u{1F928}", "\u{1F610}", "\u{1F611}", "\u{1F636}", "\u{1F60F}", "\u{1F612}", "\u{1F644}", "\u{1F62C}", "\u{1F925}",],],
  ["face-sleepy", ["\u{1F60C}", "\u{1F614}", "\u{1F62A}", "\u{1F924}", "\u{1F634}"],],
  ["face-unwell", ["\u{1F637}", "\u{1F912}", "\u{1F915}", "\u{1F922}", "\u{1F92E}", "\u{1F927}", "\u{1F975}", "\u{1F976}", "\u{1F974}", "\u{1F635}", "\u{1F92F}",],],
  ["face-hat", ["\u{1F920}", "\u{1F973}"]],
  ["face-glasses", ["\u{1F60E}", "\u{1F913}", "\u{1F9D0}"]],
  [ "face-concerned", [ "\u{1F615}", "\u{1F61F}", "\u{1F641}", "\u{2639}", "\u{1F62E}", "\u{1F62F}", "\u{1F632}", "\u{1F633}", "\u{1F97A}", "\u{1F626}", "\u{1F627}", "\u{1F628}", "\u{1F630}", "\u{1F625}", "\u{1F622}", "\u{1F62D}", "\u{1F631}", "\u{1F616}", "\u{1F623}", "\u{1F61E}", "\u{1F613}", "\u{1F629}", "\u{1F62B}", "\u{1F971}", ], ],
  [ "face-negative", [ "\u{1F624}", "\u{1F621}", "\u{1F620}", "\u{1F92C}", "\u{1F608}", "\u{1F47F}", "\u{1F480}", "\u{2620}", ], ],
  [ "face-costume", [ "\u{1F4A9}", "\u{1F921}", "\u{1F479}", "\u{1F47A}", "\u{1F47B}", "\u{1F47D}", "\u{1F47E}", "\u{1F916}", ], ],
  [ "cat-face", [ "\u{1F63A}", "\u{1F638}", "\u{1F639}", "\u{1F63B}", "\u{1F63C}", "\u{1F63D}", "\u{1F640}", "\u{1F63F}", "\u{1F63E}", ], ],
  ["monkey-face", ["\u{1F648}", "\u{1F649}", "\u{1F64A}"]],
  [ "emotion", [ "\u{1F48B}", "\u{1F48C}", "\u{1F498}", "\u{1F49D}", "\u{1F496}", "\u{1F497}", "\u{1F493}", "\u{1F49E}", "\u{1F495}", "\u{1F49F}", "\u{2763}", "\u{1F494}", "\u{2764}", "\u{1F9E1}", "\u{1F49B}", "\u{1F49A}", "\u{1F499}", "\u{1F49C}", "\u{1F90E}", "\u{1F5A4}", "\u{1F90D}", "\u{1F4AF}", "\u{1F4A2}", "\u{1F4A5}", "\u{1F4AB}", "\u{1F4A6}", "\u{1F4A8}", "\u{1F573}", "\u{1F4A3}", "\u{1F4AC}", "\u{1F441}\u{FE0F}\u{200D}\u{1F5E8}\u{FE0F}", "\u{1F5E8}", "\u{1F5EF}", "\u{1F4AD}", "\u{1F4A4}", ], ],
  [ "hand-fingers-open", ["\u{1F44B}", "\u{1F91A}", "\u{1F590}", "\u{270B}", "\u{1F596}"], ],
  [ "hand-fingers-partial", [ "\u{1F44C}", "\u{1F90F}", "\u{270C}", "\u{1F91E}", "\u{1F91F}", "\u{1F918}", "\u{1F919}", ], ],
  [ "hand-single-finger", [ "\u{1F448}", "\u{1F449}", "\u{1F446}", "\u{1F595}", "\u{1F447}", "\u{261D}", ], ],
  [ "hand-fingers-closed", [ "\u{1F44D}", "\u{1F44E}", "\u{270A}", "\u{1F44A}", "\u{1F91B}", "\u{1F91C}", ], ],
  [ "hands", [ "\u{1F44F}", "\u{1F64C}", "\u{1F450}", "\u{1F932}", "\u{1F91D}", "\u{1F64F}", ], ],
  ["hand-prop", ["\u{270D}", "\u{1F485}", "\u{1F933}"]],
  [ "body-parts", [ "\u{1F4AA}", "\u{1F9BE}", "\u{1F9BF}", "\u{1F9B5}", "\u{1F9B6}", "\u{1F442}", "\u{1F9BB}", "\u{1F443}", "\u{1F9E0}", "\u{1F9B7}", "\u{1F9B4}", "\u{1F440}", "\u{1F441}", "\u{1F445}", "\u{1F444}", ], ],
  [ "person", [ "\u{1F476}", "\u{1F9D2}", "\u{1F466}", "\u{1F467}", "\u{1F9D1}", "\u{1F471}", "\u{1F468}", "\u{1F9D4}", "\u{1F471}\u{200D}\u{2642}\u{FE0F}", "\u{1F468}\u{200D}\u{1F9B0}", "\u{1F468}\u{200D}\u{1F9B1}", "\u{1F468}\u{200D}\u{1F9B3}", "\u{1F468}\u{200D}\u{1F9B2}", "\u{1F469}", "\u{1F471}\u{200D}\u{2640}\u{FE0F}", "\u{1F469}\u{200D}\u{1F9B0}", "\u{1F469}\u{200D}\u{1F9B1}", "\u{1F469}\u{200D}\u{1F9B3}", "\u{1F469}\u{200D}\u{1F9B2}", "\u{1F9D3}", "\u{1F474}", "\u{1F475}", ], ],
  [ "person-gesture", [ "\u{1F64D}", "\u{1F64D}\u{200D}\u{2642}\u{FE0F}", "\u{1F64D}\u{200D}\u{2640}\u{FE0F}", "\u{1F64E}", "\u{1F64E}\u{200D}\u{2642}\u{FE0F}", "\u{1F64E}\u{200D}\u{2640}\u{FE0F}", "\u{1F645}", "\u{1F645}\u{200D}\u{2642}\u{FE0F}", "\u{1F645}\u{200D}\u{2640}\u{FE0F}", "\u{1F646}", "\u{1F646}\u{200D}\u{2642}\u{FE0F}", "\u{1F646}\u{200D}\u{2640}\u{FE0F}", "\u{1F481}", "\u{1F481}\u{200D}\u{2642}\u{FE0F}", "\u{1F481}\u{200D}\u{2640}\u{FE0F}", "\u{1F64B}", "\u{1F64B}\u{200D}\u{2642}\u{FE0F}", "\u{1F64B}\u{200D}\u{2640}\u{FE0F}", "\u{1F9CF}", "\u{1F9CF}\u{200D}\u{2642}\u{FE0F}", "\u{1F9CF}\u{200D}\u{2640}\u{FE0F}", "\u{1F647}", "\u{1F647}\u{200D}\u{2642}\u{FE0F}", "\u{1F647}\u{200D}\u{2640}\u{FE0F}", "\u{1F926}", "\u{1F926}\u{200D}\u{2642}\u{FE0F}", "\u{1F926}\u{200D}\u{2640}\u{FE0F}", "\u{1F937}", "\u{1F937}\u{200D}\u{2642}\u{FE0F}", "\u{1F937}\u{200D}\u{2640}\u{FE0F}", ], ],
  [ "person-role", [ "\u{1F468}\u{200D}\u{2695}\u{FE0F}", "\u{1F469}\u{200D}\u{2695}\u{FE0F}", "\u{1F468}\u{200D}\u{1F393}", "\u{1F469}\u{200D}\u{1F393}", "\u{1F468}\u{200D}\u{1F3EB}", "\u{1F469}\u{200D}\u{1F3EB}", "\u{1F468}\u{200D}\u{2696}\u{FE0F}", "\u{1F469}\u{200D}\u{2696}\u{FE0F}", "\u{1F468}\u{200D}\u{1F33E}", "\u{1F469}\u{200D}\u{1F33E}", "\u{1F468}\u{200D}\u{1F373}", "\u{1F469}\u{200D}\u{1F373}", "\u{1F468}\u{200D}\u{1F527}", "\u{1F469}\u{200D}\u{1F527}", "\u{1F468}\u{200D}\u{1F3ED}", "\u{1F469}\u{200D}\u{1F3ED}", "\u{1F468}\u{200D}\u{1F4BC}", "\u{1F469}\u{200D}\u{1F4BC}", "\u{1F468}\u{200D}\u{1F52C}", "\u{1F469}\u{200D}\u{1F52C}", "\u{1F468}\u{200D}\u{1F4BB}", "\u{1F469}\u{200D}\u{1F4BB}", "\u{1F468}\u{200D}\u{1F3A4}", "\u{1F469}\u{200D}\u{1F3A4}", "\u{1F468}\u{200D}\u{1F3A8}", "\u{1F469}\u{200D}\u{1F3A8}", "\u{1F468}\u{200D}\u{2708}\u{FE0F}", "\u{1F469}\u{200D}\u{2708}\u{FE0F}", "\u{1F468}\u{200D}\u{1F680}", "\u{1F469}\u{200D}\u{1F680}", "\u{1F468}\u{200D}\u{1F692}", "\u{1F469}\u{200D}\u{1F692}", "\u{1F46E}", "\u{1F46E}\u{200D}\u{2642}\u{FE0F}", "\u{1F46E}\u{200D}\u{2640}\u{FE0F}", "\u{1F575}", "\u{1F575}\u{FE0F}\u{200D}\u{2642}\u{FE0F}", "\u{1F575}\u{FE0F}\u{200D}\u{2640}\u{FE0F}", "\u{1F482}", "\u{1F482}\u{200D}\u{2642}\u{FE0F}", "\u{1F482}\u{200D}\u{2640}\u{FE0F}", "\u{1F477}", "\u{1F477}\u{200D}\u{2642}\u{FE0F}", "\u{1F477}\u{200D}\u{2640}\u{FE0F}", "\u{1F934}", "\u{1F478}", "\u{1F473}", "\u{1F473}\u{200D}\u{2642}\u{FE0F}", "\u{1F473}\u{200D}\u{2640}\u{FE0F}", "\u{1F472}", "\u{1F9D5}", "\u{1F935}", "\u{1F470}", "\u{1F930}", "\u{1F931}", ], ],
  [ "person-fantasy", [ "\u{1F47C}", "\u{1F385}", "\u{1F936}", "\u{1F9B8}", "\u{1F9B8}\u{200D}\u{2642}\u{FE0F}", "\u{1F9B8}\u{200D}\u{2640}\u{FE0F}", "\u{1F9B9}", "\u{1F9B9}\u{200D}\u{2642}\u{FE0F}", "\u{1F9B9}\u{200D}\u{2640}\u{FE0F}", "\u{1F9D9}", "\u{1F9D9}\u{200D}\u{2642}\u{FE0F}", "\u{1F9D9}\u{200D}\u{2640}\u{FE0F}", "\u{1F9DA}", "\u{1F9DA}\u{200D}\u{2642}\u{FE0F}", "\u{1F9DA}\u{200D}\u{2640}\u{FE0F}", ], ],
];
```

### EmojiSelect

```tsx
import {defineComponent, ref} from "vue"
import s from './EmojiSelect.module.scss'
import emojis from "../shared/emojis"

export default defineComponent({
  props: {
    modelValue: {
      type: String,
      required: false
    }
  },
  setup(_, {emit}) {
    const selected = ref(0)
    const table: [string, string[]][] = [
      ['表情', ['face-smiling', 'face-affection', 'face-tongue', 'face-hand', 'face-neutral-skeptical', 'face-sleepy', 'face-unwell', 'face-hat', 'face-glasses', 'face-concerned', 'face-negative', 'face-costume', 'cat-face', 'monkey-face']],
      ['符号', ['emotion']],
      ['手势', ['hand-fingers-open', 'hand-fingers-partial', 'hand-single-finger', 'hand-fingers-closed', 'hands', 'hand-prop']],
      ['身体', ['body-parts']],
      ['人物', ['person', 'person-gesture', 'person-role', 'person-fantasy']],
    ]
    const selectCategory = (index: number) => {
      selected.value = index
    }
    const selectEmoji = (emoji: string) => {
      emit('update:modelValue', emoji)
    }
    return () => (
      <div class={s.emojis}>
        <nav>
          {table.map((category, index) => <span class={index === selected.value ? s.active : ''}
                                                onClick={() => selectCategory(index)}>{category[0]}</span>)}
        </nav>
        <ul>
          {
            table[selected.value][1].map(category => emojis.find(item => item[0] === category)
              ?.[1]
              .map(emoji => <li onClick={() => selectEmoji(emoji)}>{emoji}</li>))
          }
        </ul>
      </div>
    )
  },
})
```

## Tags 组件

新建 `Tags` 页面

```tsx
import {defineComponent} from "vue"  
import {RouterView} from "vue-router"  
  
export default defineComponent({  
  setup() {  
    return () => (  
      <div>  
        <RouterView />      </div>    )  
  },  
})
```

新建 `TagCreate`、`TagEdit` 空页面

```tsx
import {defineComponent} from "vue"  
  
export default defineComponent({  
  setup() {  
    return () => (  
      <div>  
        create  
      </div>  
    )  
  },  
})
```

添加路由

```ts
{  
  path: '/tags',  
  component: Tags,  
  children: [  
    { path: 'create', component: TagCreate },  
    { path: ':id/edit', component: TagEdit },  
  ]  
},
```

### TagCreate

表单验证：

```ts
type Rule<T> = {
  key: keyof T
  required?: boolean
  pattern?: RegExp
  message: string
}
export type Rules<T> = Rule<T>[]
export interface Value {
  [k: string]: string | number | null | boolean | undefined | Value
}
const validate = <T extends Value>(value: T, rules: Rules<T>) => {
  type Errors = {
    [k in keyof T]?: string[]
  }
  const errors: Errors = {}
  rules.map(rule => {
    const { key, message } = rule
    if (rule.required && !value[key]) {
      errors[key] = errors[key] ?? []
      errors[key]?.push(message)
    } else if (rule.pattern && !rule.pattern.test(value[key] as string)) {
      errors[key] = errors[key] ?? []
      errors[key]?.push(message)
    }
  })
  return errors
}

export default validate
```

使用

```tsx
import {defineComponent, reactive, ref} from "vue"
import {useRouter} from "vue-router"
import Icon from "../../components/Icon"
import MainLayout from "../../components/layouts/MainLayout"
import Button from "../../components/Button"
import EmojiSelect from "../../components/EmojiSelect"
import validate, { Rules } from "../../shared/validate"
import s from './TagCreate.module.scss'

export default defineComponent({
  setup() {
    const router = useRouter()
    const formData = reactive({
      name: '',
      sign: ''
    })
    const errors = ref<{[k in keyof typeof formData]?: string[]}>({})
    const onSubmit = (event: Event) => {
      // console.log(toRaw(formData)) // 传递给后端的数据，toRaw 是 Vue 提供的方法
      const rules: Rules<typeof formData> = [
        { key: 'name', required: true, message: '标签名不能为空' },
        { key: 'name', pattern: /^.{1,4}$/, message: '标签名长度为 1 到 4 个字符' },
        { key: 'sign', required: true, message: '符号不能为空' },
      ]
      errors.value = validate(formData, rules)
      event.preventDefault()
    }
    return () => (
      <MainLayout onNavClick={() => router.back()}>{
        {
          title: () => '新建标签',
          icon: () => <Icon name="left" width="1em" height="1em"/>,
          default: () => <>
            <form class={s.formWrapper} onSubmit={onSubmit}>
              <label class={s.tagName}>
                <span>标签名</span>
                <input type="text" v-model={formData.name} class={errors.value?.name?.[0] && s.error} placeholder='1 到 4 个字符'/>
                <p class={s.errorInfo}>{errors.value?.name?.[0]}</p>
              </label>
              <div class={s.emojiWrapper}>
                <div class={s.signWrapper}>
                  <span>符号 </span>
                  <span class={s.emoji}> {formData.sign}</span>
                </div>
                <EmojiSelect v-model={formData.sign}/>
                <p class={s.errorInfo}>{errors.value?.sign?.[0]}</p>
              </div>
              <p class={s.tips}>记账时长按标签，即可进行编辑</p>
              <Button class={s.btn}>确定</Button>
            </form>
          </>
        }
      }</MainLayout>
    )
  },
})
```

表单验证还可以这样写：

```ts
interface FData {
  [k: string]: string | number | null | undefined | FData
}
type Rule<T> = {
  key: keyof T
  message: string
} & (
    { type: 'required' } |
    { type: 'pattern', regex: RegExp }
  )
type Rules<T> = Rule<T>[]
export type { Rules, Rule, FData }
export const validate = <T extends FData>(formData: T, rules: Rules<T>) => {
  type Errors = {
    [k in keyof T]?: string[]
  }
  const errors: Errors = {}
  rules.map(rule => {
    const { key, type, message } = rule
    const value = formData[key]
    switch (type) {
      case 'required':
        if (value === null || value === undefined || value === '') {
          errors[key] = errors[key] ?? []
          errors[key]?.push(message)
        }
        break;
      case 'pattern':
        if (value && !rule.regex.test(value.toString())) {
          errors[key] = errors[key] ?? []
          errors[key]?.push(message)
        }
        break;
      default:
        return
    }
  })
  return errors
}

// 使用的话就
const formData = reactive({
  name: '',
  sign: '',
})
const errors = reactive<{ [k in keyof typeof formData]?: string[] }>({})
const rules: Rules<typeof formData> = [
  { key: 'name', type: 'required', message: '必填' },
  { key: 'name', type: 'pattern', regex: /^.{1,4}$/, message: '只能填 1 到 4 个字符' },
  { key: 'sign', type: 'required', message: '必填' },
]
// 使用 reactive 需要注意需要在这之前将 errors 置空，所以还是用 ref 好点
Object.assign(errors, validate(formData, rules))
```

### 抽离 TagForm

```tsx
import {defineComponent, reactive, ref} from "vue"
import validate, {Rules} from "../shared/validate"
import EmojiSelect from "./EmojiSelect"
import Button from "./Button"
import s from './TagForm.module.scss'

export default defineComponent({
  props: {
    buttonText: {
      type: String,
      required: false
    }
  },
  setup(props) {
    // TODO: 暴露 onSubmit
    const formData = reactive({
      name: '',
      sign: ''
    })
    const errors = ref<{ [k in keyof typeof formData]?: string[] }>({})
    const onSubmit = (event: Event) => {
      // console.log(toRaw(formData)) // 传递给后端的数据，toRaw 是 Vue 提供的方法
      const rules: Rules<typeof formData> = [
        {key: 'name', required: true, message: '标签名不能为空'},
        {key: 'name', pattern: /^.{1,4}$/, message: '标签名长度为 1 到 4 个字符'},
        {key: 'sign', required: true, message: '符号不能为空'},
      ]
      errors.value = validate(formData, rules)
      event.preventDefault()
    }
    return () => (
      <form class={s.formWrapper} onSubmit={onSubmit}>
        <label class={s.tagName}>
          <span>标签名</span>
          <input type="text" v-model={formData.name} class={errors.value?.name?.[0] && s.error}
                 placeholder='1 到 4 个字符'/>
          <p class={s.errorInfo}>{errors.value?.name?.[0]}</p>
        </label>
        <div class={s.emojiWrapper}>
          <div class={s.signWrapper}>
            <span>符号 </span>
            <span class={s.emoji}> {formData.sign}</span>
          </div>
          <EmojiSelect v-model={formData.sign}/>
          <p class={s.errorInfo}>{errors.value?.sign?.[0]}</p>
        </div>
        <p class={s.tips}>记账时长按标签，即可进行编辑</p>
        <Button class={s.btn}>{props.buttonText || '确定'}</Button>
      </form>
    )
  },
})
```

样式

```tsx
.formWrapper {
  padding: calc(var(--gap) * 2) var(--gap) 0;

  .tagName {
    position: relative;
    display: flex;
    flex-direction: column;
    gap: .5rem;
    margin-bottom: .8rem;
    padding-bottom: 1.2rem;
    color: var(--normal-text);
    font-size: 1rem;

    > input {
      appearance: none;
      padding: calc(var(--gap) / 2);
      border: 1px solid var(--border-color);
      border-radius: .5rem;
      outline: none;

      &:focus {
        border-color: var(--primary);
      }

      &.error {
        border-color: var(--error);
      }
    }
  }

  .tips {
    color: var(--normal-text);
    font-size: .9rem;
    margin-bottom: 1rem;
    text-align: center;
  }

  .btn {
    margin-top: calc(var(--gap) * 2);
    width: 100%;
    padding: calc(var(--gap));
    border-radius: .5rem;
  }
}

.emojiWrapper {
  position: relative;
  display: flex;
  flex-direction: column;
  gap: .5rem;
  margin-bottom: .8rem;
  padding-bottom: 1.2rem;
  color: var(--normal-text);
  font-size: 1rem;
  overflow: hidden;

  .signWrapper {
    display: flex;
    align-items: center;
  }
}

.errorInfo {
  position: absolute;
  left: 0;
  bottom: 0;
  font-size: .8rem;
  color: var(--error);
}
```

### 修改后的 TagCreate

```tsx
import {defineComponent} from "vue"
import {useRouter} from "vue-router"
import Icon from "../../components/Icon"
import MainLayout from "../../components/layouts/MainLayout"
import TagForm from "../../components/TagForm"
import s from './Tag.module.scss'

export default defineComponent({
  setup() {
    const router = useRouter()
    return () => (
      <MainLayout onNavClick={() => router.back()}>{
        {
          title: () => '新建标签',
          icon: () => <Icon name="left" width="1em" height="1em"/>,
          default: () => <div class={s.wrapper}>
            <TagForm />
          </div>
        }
      }</MainLayout>
    )
  },
})
```

### TagEdit

```tsx
import {defineComponent} from "vue"
import {useRouter} from "vue-router"
import Icon from "../../components/Icon"
import MainLayout from "../../components/layouts/MainLayout"
import TagForm from "../../components/TagForm"
import Button from "../../components/Button"
import s from './Tag.module.scss'

export default defineComponent({
  setup() {
    const router = useRouter()
    return () => (
      <MainLayout onNavClick={() => router.back()}>{
        {
          title: () => '标签详情',
          icon: () => <Icon name="left" width="1em" height="1em"/>,
          default: () => <div class={s.wrapper}>
            <TagForm buttonText="保存" />
            <div class={s.btnWrapper}>
              <Button class={s.btn}>删除标签</Button>
            </div>
          </div>
        }
      }</MainLayout>
    )
  },
})
```

### 公用样式

```scss
.wrapper {
  padding-bottom: calc(var(--gap) * 3);
}

.btnWrapper {
  margin-top: var(--gap);
  padding: 0 var(--gap);
}

.btn {
  width: 100%;
  padding: calc(var(--gap));
  border-radius: .5rem;
  background: var(--error);
}
```

## 完善 ItemCreate 页面

```tsx
import {defineComponent, ref} from "vue"
import Icon from "../../components/Icon"
import MainLayout from "../../components/layouts/MainLayout"
import {Tabs, Tab} from "../../components/Tabs"
import {useRouter} from "vue-router"
import InputPad from "../../components/InputPad"
import s from './ItemCreate.module.scss'
import emojis from "../../shared/emojis";

export default defineComponent({
  setup() {
    const router = useRouter()
    const kind = ref('支出')
    const expensesTags = ref([
      { name: '餐饮', id: 1, sign: emojis[0][1][12], category: 'expense' },
      { name: '交通', id: 2, sign: emojis[1][1][7], category: 'expense' },
      { name: '购物', id: 3, sign: emojis[2][1][3], category: 'expense' },
      { name: '日用', id: 4, sign: emojis[3][1][1], category: 'expense' },
      { name: '住房', id: 5, sign: emojis[4][1][1], category: 'expense' },
      { name: '娱乐', id: 6, sign: emojis[14][1][1], category: 'expense' },
      { name: '零食', id: 7, sign: emojis[14][1][2], category: 'expense' },
      { name: '学习', id: 8, sign: emojis[14][1][3], category: 'expense' },
      { name: '医疗', id: 9, sign: emojis[14][1][4], category: 'expense' },
    ])
    const incomeTags = ref([
      { name: '工资', id: 10, sign: emojis[15][1][1], category: 'income' },
      { name: '奖金', id: 11, sign: emojis[16][1][2], category: 'income' },
      { name: '理财', id: 12, sign: emojis[16][1][3], category: 'income' },
      { name: '礼金', id: 13, sign: emojis[2][1][4], category: 'income' },
      { name: '红包', id: 14, sign: emojis[4][1][5], category: 'income' },
      { name: '其他', id: 15, sign: emojis[3][1][2], category: 'income' },
    ])
    return () => (
      <MainLayout onNavClick={() => router.back()}>{
        {
          title: () => '记一笔',
          icon: () => <Icon name="left" width="1em" height="1em" />,
          other: () => <>
            <Tabs selected={kind.value} v-model:selected={kind.value}>
              <Tab name="支出">
                <div class={s.expenseWrapper}>
                  <div class={s.tag}><Icon class={s.tagSign} name='add' /></div>
                  {expensesTags.value.map(tag => (<div class={s.tag} key={tag.id}>
                    <span class={s.tagSign}>{tag.sign}</span>
                    <span class={s.tagName}>{tag.name}</span>
                  </div>))}
                </div>
              </Tab>
              <Tab name="收入">
                <div class={s.incomeWrapper}>
                  <div class={s.tag}><Icon class={s.tagSign} name='add'/></div>
                  {incomeTags.value.map(tag => (<div class={s.tag} key={tag.id}>
                    <span class={s.tagSign}>{tag.sign}</span>
                    <span class={s.tagName}>{tag.name}</span>
                  </div>))}
                </div>
              </Tab>
            </Tabs>
          </>,
          default: () => <>
            <div class={s.inputPad_wrapper}>
              <InputPad />
            </div>
          </>
        }
      }</MainLayout>
    )
  },
})
```

## ItemList 页面

### 重构时间库

```ts
class Time {
  date: Date

  constructor(date = new Date()) {
    this.date = date
  }

  /**
   * 格式化时间
   * @param pattern<string> YYYY MM DD HH mm ss
   * @returns string
   * @example time.format('YYYY-MM-DD HH:mm:ss')
   */
  format(pattern = 'YYYY-MM-DD HH:mm:ss') {
    const year = this.date.getFullYear()
    const month = this.date.getMonth() + 1
    const day = this.date.getDate()
    const hour = this.date.getHours()
    const minute = this.date.getMinutes()
    const second = this.date.getSeconds()
    return pattern
      .replace(/YYYY/g, year.toString())
      .replace(/YY/g, year.toString().slice(-2))
      .replace(/MM/g, month.toString().padStart(2, '0'))
      .replace(/DD/g, day.toString().padStart(2, '0'))
      .replace(/HH/g, hour.toString().padStart(2, '0'))
      .replace(/mm/g, minute.toString().padStart(2, '0'))
      .replace(/ss/g, second.toString().padStart(2, '0'))
  }

  /**
   * 当前月的第一天
   * @returns Time
   * @example time.firstDayOfMonth()
   */
  firstDayOfMonth() {
    return new Time(new Date(this.date.getFullYear(), this.date.getMonth(), 1, 0, 0, 0))
  }

  /**
   * 当前月的最后一天
   * @returns Time
   * @example time.lastDayOfMonth()
   */
  lastDayOfMonth() {
    return new Time(new Date(this.date.getFullYear(), this.date.getMonth() + 1, 0, 23, 59, 59))
  }

  /**
   * 当前季度的第一天
   * @returns Time
   * @example time.firstDayOfQuarter()
   */
  firstDayOfQuarter() {
    const month = this.date.getMonth()
    const quarter = Math.floor(month / 3)
    return new Time(new Date(this.date.getFullYear(), quarter * 3, 1, 0, 0, 0))
  }

  /**
   * 当前季度的最后一天
   * @returns Time
   * @example time.lastDayOfQuarter()
   */
  lastDayOfQuarter() {
    const month = this.date.getMonth()
    const quarter = Math.floor(month / 3)
    return new Time(new Date(this.date.getFullYear(), quarter * 3 + 3, 0, 23, 59, 59))
  }

  /**
   * 今年的第一天
   * @returns Time
   * @example time.firstDayOfYear()
   */
  firstDayOfYear() {
    return new Time(new Date(this.date.getFullYear(), 0, 1, 0, 0, 0))
  }

  /**
   * 今年的最后一天
   * @returns Time
   * @example time.lastDayOfYear()
   */
  lastDayOfYear() {
    return new Time(new Date(this.date.getFullYear(), 11, 31, 23, 59, 59))
  }

  /**
   * 获取当前时间戳
   * @returns number
   * @example time.timestamp()
   */
  timestamp() {
    return this.date.getTime()
  }

  /**
   * 加减时间
   * @param {number} num
   * @param {string} unit
   * @returns Time
   * @example time.add(1, 'day')
   */
  add(num: number, unit: 'year' | 'month' | 'day' | 'hour' | 'minute' | 'second' | 'millisecond' = 'day') {
    const date = new Date(this.timestamp())
    switch (unit) {
      case 'year':
        date.setFullYear(date.getFullYear() + num)
        break
      case 'month':
        const d = date.getDate()
        date.setDate(1)
        date.setMonth(date.getMonth() + num)
        const d2 = new Date(date.getFullYear(), date.getMonth() + 1, 0, 0, 0, 0).getDate()
        date.setDate(Math.min(d, d2))
        break
      case 'day':
        date.setDate(date.getDate() + num)
        break
      case 'hour':
        date.setHours(date.getHours() + num)
        break
      case 'minute':
        date.setMinutes(date.getMinutes() + num)
        break
      case 'second':
        date.setSeconds(date.getSeconds() + num)
        break
      case 'millisecond':
        date.setMilliseconds(date.getMilliseconds() + num)
        break
      default:
        throw new Error('Invalid unit')
        break
    }
    return new Time(date)
  }

  subtract(num: number, unit: 'year' | 'month' | 'day' | 'hour' | 'minute' | 'second' = 'day') {
    return this.add(-num, unit)
  }
}

const time = (date: Date = new Date()) => new Time(date)

export {
  Time,
  time
}
```

### ItemSummary 组件

```tsx
import {defineComponent, ref} from "vue"
import s from './ItemSummary.module.scss'

export default defineComponent({
  props: {
    startDate: {
      type: String,
      required: true,
    },
    endDate: {
      type: String,
      required: true,
    },
  },
  setup(props) {
    const moreVisible = ref(false)
    return () => (
      <div class={s.wrapper}>
        { console.log(props.startDate, props.endDate) }
        <ul class={s.total}>
          <li><span>收入</span><span>128</span></li>
          <li><span>支出</span><span>100</span></li>
          <li><span>净收入</span><span>28</span></li>
        </ul>
        <ul class={s.list}>
          <li>
            <div class={s.description}>
              <div class={s.sign}>🤥</div>
              <div>
                <h2>旅行</h2>
                <p>2021-01-23 12:31</p>
              </div>
            </div>
            <div class={[s.amount, s.expense]}>￥ 1234</div>
          </li>
          <li>
            <div class={s.description}>
              <div class={s.sign}>🤥</div>
              <div>
                <h2>旅行</h2>
                <p>2021-01-23 12:31</p>
              </div>
            </div>
            <div class={[s.amount, s.income]}>￥ 1234</div>
          </li>
        </ul>
        {moreVisible.value && <p class={s.more}>上滑查看更多</p>}
      </div>
    )
  },
})
```

### Dialog 组件

```tsx
import {defineComponent, Teleport} from "vue"
import s from './Dialog.module.scss'

export default defineComponent({
  emits: ['update:dialogVisible'],
  props: {
    title: {
      type: String,
      default: '提示',
    },
    showConfirmButton: {
      type: Boolean,
      default: true,
    },
    showCancelButton: {
      type: Boolean,
      default: false,
    },
    onClose: {
      type: Function,
    },
    onConfirm: {
      type: Function,
    },
    dialogVisible: {
      type: Boolean,
      default: false,
    }
  },
  setup(props, {emit, slots}) {
    const onClose = () => {
      emit('update:dialogVisible', false)
    }
    const onConfirm = () => {
      onClose()
      props.onConfirm?.()
    }
    return () => (
      <Teleport to="body">
        <dialog class={s.dialog} open={props.dialogVisible}>
          <header>
            <h2>{props.title}</h2>
          </header>
          <main>{slots.default?.()}</main>
          <footer>
            {props.showCancelButton && <span onClick={onClose}>取消</span>}
            {props.showConfirmButton && <span onClick={onConfirm}>确定</span>}
          </footer>
        </dialog>
      </Teleport>
    )
  },
})
```

### Form 组件

```tsx
import {computed, defineComponent, PropType, ref} from "vue"
import {DatetimePicker, Popup} from "vant"
import EmojiSelect from "./EmojiSelect"
import s from './Form.module.scss'
import {time} from "../shared/time"

export const Form = defineComponent({
  props: {
    onSubmit: {
      type: Function as PropType<(e: Event) => void>
    },
  },
  setup(props, {slots}) {
    return () => (
      <form onSubmit={props.onSubmit}>
        {slots.default?.()}
      </form>
    )
  },
})

export const FormItem = defineComponent({
  props: {
    label: {
      type: String,
    },
    modelValue: {
      type: [String, Number, Date],
    },
    type: {
      type: String as PropType<'text' | 'emojiSelect' | 'date'>,
    },
    placeholder: {
      type: String,
    },
    error: {
      type: String,
    },
    onClick: {
      type: Function as PropType<(e: Event) => void>
    },
  },
  setup(props, {slots, emit}) {
    const dataPickerVisible = ref(false)
    const formatter = (type: string, val: string) => {
      if (type === 'year') {
        return val + '年'
      } else if (type === 'month') {
        return val + '月'
      } else if (type === 'day') {
        return val + '日'
      }
      return val
    }
    const content = computed(() => {
      switch (props.type) {
        case 'text':
          return <input type="text" class={props.error ? s.error : ''} placeholder={props.placeholder} value={props.modelValue} onInput={(e) => {
            emit('update:modelValue', (e.target as HTMLInputElement).value)
          }}/>
        case 'emojiSelect':
          return <EmojiSelect modelValue={props.modelValue?.toString()} onUpdate:modelValue={(value: string) => { emit('update:modelValue', value) }} />
        case 'date':
          return <>
            <input readonly={true}
                   onClick={() => {
                     dataPickerVisible.value = true
                   }}
                   value={time(props.modelValue as Date).format('YYYY-MM-DD')}
                   class={[s.formItem, s.input]} />
            <Popup position='bottom' v-model:show={dataPickerVisible.value}>
              <DatetimePicker value={props.modelValue} type="date" title="选择年月日"
                              formatter={formatter}
                              onConfirm={(date: Date) => {
                                emit('update:modelValue', date)
                                dataPickerVisible.value = false
                              }}
                              onCancel={() =>dataPickerVisible.value = false} />
            </Popup>
          </>
        case undefined:
        default:
          return slots.default?.()
      }
    })
    return () => (
      <label class={s.formRow}>
        {props.label && <span class={s.labelText}>{props.label}</span>}
        <div class={s.content}>{content.value}</div>
        {props.error && <p  class={s.errorInfo}>{props.error}</p>}
      </label>
    )
  },
})
```

### ItemList

```tsx
import {defineComponent, ref} from "vue"
import Icon from "../../components/common/Icon"
import MainLayout from "../../components/layouts/MainLayout"
import {Tabs, Tab} from "../../components/Tabs"
import {useRouter} from "vue-router"
import s from './ItemList.module.scss'
import ItemSummary from "../../components/ItemSummary"
import {time, Time} from "../../shared/time"
import Dialog from "../../components/common/Dialog"
import {Form, FormItem} from "../../components/Form"

export default defineComponent({
  setup() {
    const router = useRouter()
    const selectedTab = ref('本月')
    const t = new Time()
    const startDate = ref(new Date())
    const endDate = ref(new Date())
    const timeList = [
      {start: t.firstDayOfMonth().format('YYYY-MM-DD'), end: t.lastDayOfMonth().format('YYYY-MM-DD')},
      {start: t.subtract(1, 'month').firstDayOfMonth().format('YYYY-MM-DD'), end: t.subtract(1, 'month').lastDayOfMonth().format('YYYY-MM-DD')},
      {start: t.firstDayOfYear().format('YYYY-MM-DD'), end: t.lastDayOfYear().format('YYYY-MM-DD')},
    ]
    const dialogVisible = ref(false)
    return () => (
      <MainLayout onNavClick={() => router.back()}>{
        {
          title: () => '菠萝记账',
          icon: () => <Icon name="left" width="1em" height="1em"/>,
          other: () => <>
            <Tabs selected={selectedTab.value} v-model:selected={selectedTab.value}
                  onUpdate:selected={() => dialogVisible.value = true}
            >
              <Tab name="本月">
                <ItemSummary startDate={timeList[0].start}
                             endDate={timeList[0].end}/>
              </Tab>
              <Tab name="上月">
                <ItemSummary startDate={timeList[1].start}
                             endDate={timeList[1].end}/>
              </Tab>
              <Tab name="今年">
                <ItemSummary startDate={timeList[2].start}
                             endDate={timeList[2].end}/>
              </Tab>
              <Tab name="自定义">
                <ItemSummary startDate={time(startDate.value).format('YYYY-MM-DD')}
                             endDate={time(endDate.value).format('YYYY-MM-DD')}/>
                <Dialog v-model:dialogVisible={dialogVisible.value} title="自定义时间" showCancelButton onConfirm={() => {
                  // TODO: startDate.value endDate.value
                }}>
                  <Form>
                    <FormItem type="date" label="开始时间" v-model={startDate.value}></FormItem>
                    <FormItem type="date" label="结束时间" v-model={endDate.value}></FormItem>
                  </Form>
                </Dialog>
              </Tab>
            </Tabs>
          </>,
          default: () => <>
            <div class={s.wrapper}>
            </div>
          </>
        }
      }</MainLayout>
    )
  },
})
```

## 登录页面

`route.ts`

```ts
{  
  path: '/sign_in',  
  component: SignIn  
},
```

`Form.tsx` 中新增一个

```tsx
case 'smsCode':  
  return <div class={s.smsCode}>  
    <input type="text" class={props.error ? [s.error, s.smsInput] : s.smsInput} placeholder={props.placeholder} value={props.modelValue} onInput={(e) => {  
      emit('update:modelValue', (e.target as HTMLInputElement).value)  
    }}/>  
    <Button type="button" class={s.smsBtn} onClick={props.onClick}>获取验证码</Button>  
  </div>
```

`SignIn.tsx`

```tsx
import {defineComponent, reactive, ref} from "vue"
import {useRouter} from "vue-router"
import Button from "../components/common/Button"
import Icon from "../components/common/Icon"
import MainLayout from "../components/layouts/MainLayout"
import {Form, FormItem} from "../components/Form"
import validate, {Rules} from "../shared/validate"
import s from './SignIn.module.scss'

export default defineComponent({
  setup() {
    const router = useRouter()
    const formData = reactive({
      email: '',
      smsCode: '',
    })
    const errors = ref<{ [k in keyof typeof formData]?: string[] }>({})
    const onSubmit = (event: Event) => {
      const rules: Rules<typeof formData> = [
        {key: 'email', required: true, message: '邮箱地址不能为空'},
        {key: 'email', pattern: /.+@.+\..+/, message: '请输入正确的邮箱地址（形如 a@b.com）'},
        {key: 'smsCode', required: true, message: '验证码不能为空'},
        {key: 'smsCode', pattern: /^\d{6}$/, message: '请输入6位数字'},
      ]
      errors.value = validate(formData, rules)
      event.preventDefault()
    }
    return () => (
      <div class={s.wrapper}>
        <MainLayout onNavClick={() => router.back()}>{
          {
            title: () => '登录',
            icon: () => <Icon name="left" width="1.2em" height="1.2em"/>,
            default: () => <>
              <div class={s.center}>
                <Icon name="pineapple" width="4em" height="4em"/>
                <h1>菠萝记账</h1>
              </div>
              <Form onSubmit={onSubmit}>
                <FormItem label="邮箱地址" type="text" placeholder="请输入邮箱" v-model={formData.email}
                          error={errors.value.email?.[0]}/>
                <FormItem label="邮箱验证码" type="smsCode" placeholder="请输入6位数字" v-model={formData.smsCode}
                          error={errors.value.smsCode?.[0]}/>
                <FormItem>
                  <Button class={s.button}>登录</Button>
                </FormItem>
              </Form>
            </>
          }
        }</MainLayout>
      </div>
    )
  },
})
```

## 统计图表页面

ItemList 和 Stat 都用同一个布局

```tsx
import {defineComponent, PropType, reactive, ref} from "vue"
import Icon from "../common/Icon"
import MainLayout from "./MainLayout"
import {Tabs, Tab} from "../Tabs"
import {time, Time} from "../../shared/time"
import Dialog from "../common/Dialog"
import {Form, FormItem} from "../Form"
import Overlay from "../Overlay"

const X = defineComponent({
  props: {
    startDate: {
      type: String,
      required: true,
    },
    endDate: {
      type: String,
      required: true,
    },
  },
})

export default defineComponent({
  props: {
    component: {
      type: Object as PropType<typeof X>,
      required: true
    },
  },
  setup(props) {
    const selectedTab = ref('本月')
    const t = new Time()
    const customDate = reactive([new Date(), new Date()])
    const timeList = [
      {start: t.firstDayOfMonth().format('YYYY-MM-DD'), end: t.lastDayOfMonth().format('YYYY-MM-DD')},
      {
        start: t.subtract(1, 'month').firstDayOfMonth().format('YYYY-MM-DD'),
        end: t.subtract(1, 'month').lastDayOfMonth().format('YYYY-MM-DD')
      },
      {start: t.firstDayOfYear().format('YYYY-MM-DD'), end: t.lastDayOfYear().format('YYYY-MM-DD')},
    ]
    const dialogVisible = ref(false)
    const overlayVisible = ref(false)
    return () => (
      <MainLayout onNavClick={() => overlayVisible.value = true}>{
        {
          title: () => '菠萝记账',
          icon: () => <Icon name="menu" width="1em" height="1em"/>,
          other: () => <>
            <Tabs selected={selectedTab.value} v-model:selected={selectedTab.value}
                  onUpdate:selected={() => dialogVisible.value = true}
            >
              <Tab name="本月">
                <props.component startDate={timeList[0].start} endDate={timeList[0].end}/>
              </Tab>
              <Tab name="上月">
                <props.component startDate={timeList[1].start} endDate={timeList[1].end}/>
              </Tab>
              <Tab name="今年">
                <props.component startDate={timeList[2].start} endDate={timeList[2].end}/>
              </Tab>
              <Tab name="自定义">
                <props.component startDate={time(customDate[0]).format('YYYY-MM-DD')}
                                 endDate={time(customDate[1]).format('YYYY-MM-DD')}/>
                <Dialog v-model:dialogVisible={dialogVisible.value} title="自定义时间" showCancelButton
                        onConfirm={() => {
                          // TODO: startDate.value endDate.value
                        }}>
                  <Form>
                    <FormItem type="date" label="开始时间" v-model={customDate[0]}></FormItem>
                    <FormItem type="date" label="结束时间" v-model={customDate[1]}></FormItem>
                  </Form>
                </Dialog>
              </Tab>
            </Tabs>
          </>,
          default: () => <>
            <Overlay show={overlayVisible.value} onClose={() => overlayVisible.value = false}/>
          </>
        }
      }</MainLayout>
    )
  },
})
```

现在的 ItemList

```tsx
import {defineComponent} from "vue"
import {RouterLink} from "vue-router"
import ItemSummary from "../../components/ItemSummary"
import TimeTabsLayout from "../../components/layouts/TimeTabsLayout"
import FloatButton from "../../components/common/FloatButton"

export default defineComponent({
  setup() {
    return () => (
      <>
        <TimeTabsLayout component={ItemSummary}/>
        <RouterLink to="/items/create">
          <FloatButton iconName="add"/>
        </RouterLink>
      </>
    )
  },
})
```

Statistics.tsx

```tsx
import {defineComponent} from "vue"
import TimeTabsLayout from "../components/layouts/TimeTabsLayout"
import Charts from "../components/statistics/Charts"
import s from './Statistics.module.scss'

export default defineComponent({
  setup() {
    return () => (
      <div class={s.wrapper}>
        <TimeTabsLayout component={Charts} />
      </div>
    )
  },
})
```

后面的内容都在 Charts 组件中

在 Form 里面封装一个 select

```tsx
// props 添加
options: {  
  type: Array as PropType<{ value: string, text: string }[]>,  
},

// 下面添加
case 'select':
  return <select onChange={(e: Event) => {
    emit('update:modelValue', (e.target as HTMLSelectElement).value)
  }}>
    {props.options?.map(option => <option value={option.value}>{option.text}</option>)}
  </select>
```

页面下三个

```tsx
import {defineComponent, onMounted, ref} from "vue"
import * as echarts from 'echarts'
import s from './LineChart.module.scss'

export default defineComponent({
  setup() {
    const lineRef = ref<HTMLElement>()
    onMounted(() => {
      if (lineRef.value === undefined) return
      const lineChart = echarts.init(lineRef.value)
      const option = {
        grid: {
          top: '4%',
          bottom: '3%',
          left: '3%',
          right: '4%',
          containLabel: true
        },
        xAxis: {
          type: 'category',
          data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun']
        },
        yAxis: {
          type: 'value'
        },
        series: [
          {
            data: [150, 230, 224, 218, 135, 147, 260],
            type: 'line'
          }
        ]
      }
      lineChart.setOption(option)
    })
    return () => (
      <div ref={lineRef} class={s.lineChart}></div>
    )
  },
})

import {defineComponent, onMounted, ref} from "vue"
import * as echarts from 'echarts'
import s from './PieChart.module.scss'

export default defineComponent({
  setup() {
    const pieRef = ref<HTMLElement>()
    onMounted(() => {
      if (pieRef.value === undefined) return
      const pieChart = echarts.init(pieRef.value)
      const option = {
        grid: {
          top: '4%',
          bottom: '3%',
          left: '3%',
          right: '4%',
          containLabel: true
        },
        series: [
          {
            name: 'Access From',
            type: 'pie',
            radius: '50%',
            data: [
              {value: 1048, name: 'Search Engine'},
              {value: 735, name: 'Direct'},
              {value: 580, name: 'Email'},
              {value: 484, name: 'Union Ads'},
              {value: 300, name: 'Video Ads'}
            ],
            emphasis: {
              itemStyle: {
                shadowBlur: 10,
                shadowOffsetX: 0,
                shadowColor: 'rgba(0, 0, 0, 0.5)'
              }
            }
          }
        ]
      }
      pieChart.setOption(option)
    })
    return () => (
      <div ref={pieRef} class={s.pieChart}></div>
    )
  },
})

import {computed, defineComponent, reactive} from "vue"
import s from './Bars.module.scss'

export default defineComponent({
  setup() {
    const colors = ['#5470c6', '#91cc75', '#fac858', '#ee6666', '#73c0de', '#3ba272', '#fc8452', '#9a60b4', '#ea7ccc']
    const barData = reactive([
      {id: 1, kind: 'expense', tag: {id: 1, name: '餐饮', sign: '😋'}, amount: 100},
      {id: 2, kind: 'expense', tag: {id: 2, name: '游玩', sign: '😋'}, amount: 30},
      {id: 3, kind: 'expense', tag: {id: 3, name: '通讯', sign: '😍'}, amount: 200},
      {id: 4, kind: 'expense', tag: {id: 4, name: '交往', sign: '🙂'}, amount: 38},
      {id: 5, kind: 'expense', tag: {id: 5, name: '红包', sign: '😋'}, amount: 30},
      {id: 6, kind: 'expense', tag: {id: 6, name: '娱乐', sign: '😋'}, amount: 30},
    ])
    const barDataCal = computed(() => {
      const total = barData.reduce((sum, item) => sum + item.amount, 0)
      return barData.map((item, i) => ({
        ...item,
        percent: Math.round(item.amount / total * 100) + '%',
        bg: colors[i]
      }))
    })
    return () => (
      <ul class={s.barChart}>
        {barDataCal.value.map(item => <li key={item.id}>
          <div class={s.sign}>{item.tag.sign}</div>
          <div class={s.barWrapper}>
            <div class={s.info}>
              <span>{item.tag.name} - {item.percent}</span>
              <span>￥{item.amount}</span>
            </div>
            <div style={{'--w': item.percent, '--bg': item.bg}} class={s.bar}></div>
          </div>
        </li>)}
      </ul>
    )
  },
})

// 使用 EChart 需要给容器设置合适的宽高
```

Chart

```tsx
import {defineComponent, ref} from "vue"
import {FormItem} from "../Form"
import LineChart from "./LineChart"
import PieChart from "./PieChart"
import Bars from "./Bars"
import s from './Charts.module.scss'

export default defineComponent({
  props: {
    startDate: {
      type: String,
      required: true,
    },
    endDate: {
      type: String,
      required: true,
    },
  },
  setup(props) {
    const kind = ref('expense')
    const options = [
      {value: 'expense', text: '支出'},
      {value: 'income', text: '收入'},
    ]
    return () => (
      <div class={s.wrapper}>
        {props.startDate + '-' + props.endDate}
        <FormItem label="类型" type="select" v-model={kind.value} options={options}/>
        <LineChart />
        <PieChart />
        <Bars />
      </div>
    )
  },
})
```
