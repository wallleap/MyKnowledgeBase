---
title: 047-Vue 3 ç»„ä»¶
date: 2023-08-15T01:49:00+08:00
updated: 2024-08-21T10:32:38+08:00
dg-publish: false
aliases:
  - Vue 3 ç»„ä»¶
author: Luwang
category: web
comments: true
cover: //cdn.wallleap.cn/img/post/1.jpg
description: æ–‡ç« æè¿°
image-auto-upload: true
keywords:
  - å…³é”®è¯1
  - å…³é”®è¯2
  - å…³é”®è¯3
rating: 1
source: #
tags:
  - Vue
  - web
url: //myblog.wallleap.cn/post/1
---

## ç»„ä»¶æ³¨å†Œ

å…¨å±€ç»„ä»¶ï¼šå¯ä»¥åœ¨ä»»ä½•ç»„ä»¶å†…ä½¿ç”¨

```html
<div id="app">
  å…¨å±€ç»„ä»¶åœ¨ä»»ä½•ç»„ä»¶å†…éƒ½èƒ½ä½¿ç”¨
  <component-a></component-a>
  <component-b></component-b>
</div>
<script src="https://unpkg.com/vue@next"></script>
<script>
  const app = Vue.createApp({})
  app.component('component-a', {
    template: `
      <div>a</div>
      <component-b></component-b>
    `
  })
  app.component('ComponentB', {
    template: `<div>b</div>`
  })
  app.mount('#app')
</script>
```

å±€éƒ¨ç»„ä»¶ï¼šåªèƒ½åœ¨è¯¥ç»„ä»¶å†…ä½¿ç”¨

```html
<div id="app">
  ç»„ä»¶å†…å­ç»„ä»¶åªèƒ½åœ¨è¯¥ç»„ä»¶å†…ä½¿ç”¨
  <component-a></component-a>
  <!-- component-b åªèƒ½åœ¨component-aå†…ä½¿ç”¨ -->
  <!-- <component-b></component-b> -->
</div>
<script src="https://unpkg.com/vue@next"></script>
<script>
  const ComponentB = {
    template: `<div>ComponentB</div>`
  }
  const ComponentA = {
    components: {
      // 'component-b': ComponentB,
      ComponentB // ç®€å†™
    },
    template: `
      <div>ComponentA</div>
      <component-b></component-b>
    `
  }

  Vue.createApp({
    components: { 
      ComponentA
    }
  }).mount('#app')
</script>
```

ç»„ä»¶å‘½åï¼š

- kebab-case çŸ­æ¨ªçº¿è¿æ¥å…¨å°å†™çš„å•è¯
	- å£°æ˜æ—¶ä½¿ç”¨ kebab-caseï¼Œæ¨¡æ¿é‡Œå¿…é¡»ç”¨ kebaba-case
- PascalCase å¤šä¸ªé¦–å­—æ¯å¤§å†™å•è¯è¿æ¥
	- å£°æ˜æ—¶ä½¿ç”¨é©¼å³°å†™æ³•ï¼Œæ¨¡æ¿é‡Œä¸¤è€…éƒ½å¯ä»¥

## çˆ¶ä¼ å­ -props

å­ç»„ä»¶é€šè¿‡ props æ¥æ”¶æ•°æ®

```html
<div id="app">
  <user v-bind="user"></user>
  <user v-bind:username="user.username" :id="[1,2,3]"></user>
</div>
<script src="https://unpkg.com/vue@next"></script>
<script>
  const User = {
    props: ['username', 'id'],
    template: `<div>{{username}}, {{id}}</div>`
  }

  Vue.createApp({
    components: { User },
    data() {
      return { 
        user: {
          username: 'hunger',
          id: 1
        }
    }
    }
  }).mount('#app')
</script>
```

å‡ ç§ props å†™æ³•èŒƒä¾‹

```js
// æ•°ç»„
props: ['name', 'other']
// å¯¹è±¡
props: {
  name: String, // ç±»å‹
  other: Number // Boolean, Array, Object, Function
}
// æ›´å¤šé…ç½®
props: {
  name: {
    type: String,
    required: true,
    default: 'nickname'
  }
}
// åœ¨ script setup ä¸­ç›´æ¥ä½¿ç”¨ definePropsï¼Œä¸éœ€è¦å¼•å…¥
const props = defineProps({
  msg: String
})
```

çˆ¶ç»„ä»¶ä¸­é€šè¿‡å±æ€§ä¼ é€’æ•°æ®ï¼Œå¦‚æœè¦ä¼ å…¥çš„ä¸æ˜¯å­—ç¬¦ä¸²ï¼Œåˆ™éœ€è¦ä½¿ç”¨ `v-bind` ç»‘å®š

```html
<User name="luwang" />
<User :age="23" :calc="23+1" />
<User :show="true" />
```

å¦‚æœä¼ çš„æ˜¯å¯¹è±¡ï¼Œå¯ä»¥æ•´ä¸ªä¼ å…¥ï¼Œ`v-bind` åä¸æ¥ `property`

```html
post: {
  id: 1,
  title: 'First Post'
}
<post-card v-bind="post" />
<!-- è¿™ä¸¤ä¸ªç­‰ä»· -->
<post-card v-bind:id="post.id" v-bind:title="post.title" />
```

é Prop çš„ Attribute å°†ä¼šè‡ªåŠ¨åŠ åˆ°å­ç»„ä»¶çš„æ ¹èŠ‚ç‚¹çš„å±æ€§ä¸­ï¼ˆä¾‹å¦‚ classã€idã€data-attr ç­‰ï¼‰

- åœ¨å­ç»„ä»¶ä¸­å¯ä»¥é€šè¿‡ `$attrs`/`this.$attrs` è·å– attributes

```html
<div id="app">
  <user class="username" :data-user="username"></user>
</div>
<script src="https://unpkg.com/vue@next"></script>
<script>
  const User = {
    template: `<div>{{$attrs['data-user']}}</div>`,
    created() {
      console.log(this.$attrs['data-user'])
    }
  }

  Vue.createApp({
    components: { User },
    data() {
      return { username: 'hunger' }
    }
  }).mount('#app')
</script>
```

- å¦‚æœæƒ³åœ¨éæ ¹èŠ‚ç‚¹åº”ç”¨ä¼ é€’çš„ attributeï¼Œå¯ä»¥ä½¿ç”¨ `v-bind="$attrs"`

```html
<div id="app">
  <username class="username" :error="errorMsg" @input="onInput"></username>
</div>
<script src="https://unpkg.com/vue@next"></script>
<script>
  const Username = {
    props: ['error'],
    template: `
    <fieldset>
      <legend>ç”¨æˆ·å</legend>
      <input v-bind="$attrs">
      <div>{{error}}</div>
    </fieldset>
    `
  }

  Vue.createApp({
    components: { Username },
    data() {
      return {  errorMsg: '' }
    },
    methods: {
      onInput(e){
        this.errorMsg = e.target.value.length<6?"é•¿åº¦ä¸å¤Ÿ":""
      }
    }
  }).mount('#app')
</script>
```

## å­ä¼ çˆ¶ - è‡ªå®šä¹‰äº‹ä»¶

- å­ç»„ä»¶å†…è§¦å‘äº‹ä»¶ç”¨ `this.$emit('my-event')`
- çˆ¶ç»„ä»¶ä½¿ç”¨å­ç»„ä»¶æ—¶ç»‘å®š `<child @my-event="doSomething"></child>`
- äº‹ä»¶æ¨èä½¿ç”¨é©¼å³°å‘½å

```html
<div id="app">
  <h1>{{username}}</h1>
  <user class="username" :user="username" @change-user="username=$event"></user>
</div>
<script src="https://unpkg.com/vue@next"></script>
<script>
  const User = {
    props: ['user'],
    events: ['change-user'],
    template: `<div>{{user}} <button @click="updateUser">update</button></div>`,
    methods: {
      updateUser() {
        this.$emit('change-user', this.user + '!')
      }
    }
  }

  Vue.createApp({
    components: { User },
    data() {
      return { username: 'hunger' }
    }
  }).mount('#app')
</script>
```

`v-model` è¯­æ³•ç³–ï¼š

- `<comp v-model:foo="bar"></comp>` ç­‰ä»·äº `<comp :foo="bar" @update:foo="bar=$event"></comp>`
- äº‹ä»¶åæ˜¯ `update:my-event`

```html
<div id="app">
  <h1>{{username}}</h1>
  <user v-model:user="username" v-model:id="id"></user>
  <user :user="username" @update:user="username=$event"></user>
</div>
<script src="https://unpkg.com/vue@next"></script>
<script>
  const User = {
    // events: ['update:user', 'update:id'] // å¯¹äº v-model å¯ä»¥ä¸å†™ events
    props: ['user', 'id'],
    template: `<div>{{user}}  {{id}}<button @click="updateUser">update</button></div>`,
    methods: {
      updateUser() {
        this.$emit('update:user', this.user + '!')
        this.$emit('update:id', this.id++)
      }
    }
  }

  Vue.createApp({
    components: { User },
    data() {
      return { username: 'hunger', id: 100 }
    }
  }).mount('#app')
</script>
```

setup è¯­æ³•ç³–

```vue
<!-- çˆ¶ç»„ä»¶ -->
<script setup>
import Child from './child.vue'
const getMessage = (msg) => {
  console.log(msg)
}
</script>
<template>
  <Child @get-message="getMessage" />
</template>

<!-- å­ç»„ä»¶ -->
<script setup>
const emit = defineEmits(['get-message'])
const sendMsg = () => {
  emit('get-message', 'ä¼ é€’çš„æ¶ˆæ¯')
}
</script>
<template>
  <button @click="sendMsg">Click</button>
</template>
```

## æ’æ§½ slot

- å­ç»„ä»¶çš„æ¨¡æ¿ä¸­é¢„ç•™ä¸€ä¸ªç©ºä½ï¼ˆslotï¼‰
- çˆ¶ç»„ä»¶ä½¿ç”¨å­ç»„ä»¶æ—¶å¯ä»¥åœ¨å­ç»„ä»¶æ ‡ç­¾å†…æ’å…¥å†…å®¹/ç»„ä»¶ï¼Œå³å‘å­ç»„ä»¶å†…é¢„ç•™çš„ç©ºä½æ’å…¥
- çˆ¶ç»„ä»¶å¾€æ’æ§½æ’å…¥çš„å†…å®¹åªèƒ½ä½¿ç”¨çˆ¶ç»„ä»¶å®ä¾‹çš„å±æ€§

```html
<div id="app">
  <x-button> <icon name="no"></icon> {{text}} </x-button>
</div>
<script src="https://unpkg.com/vue@next"></script>

<script>
  const Icon = {
    props: ['name'],
    template: `<span>{{type}}</span>`,
    computed: {
      type() { return this.name==='yes'?'âœ”':'âœ˜' }
    }
  }
  const XButton = {
    template: `<button>
      <slot></slot>
    </button>`
  }
  Vue.createApp({
    components: { XButton, Icon },
    data() {
      return { text: 'æ­£ç¡®' }
    }
  }).mount('#app')
</script>
```

æ’æ§½é»˜è®¤å€¼ï¼šå¯ä»¥åœ¨ slot ä¸­å†™å†…å®¹ï¼Œå¦‚æœçˆ¶ç»„ä»¶ä¸­åŠ äº†å†…å®¹åˆ™ä½¿ç”¨ç›¸åº”çš„å†…å®¹ï¼Œå¦‚æœæ²¡æœ‰å°±ç”¨é»˜è®¤å€¼

```html
<div id="app">
  <x-button type="big"> OK </x-button>
  <x-button type="small"></x-button>
  <x-button type="default"> {{type}} </x-button>
</div>
<script src="https://unpkg.com/vue@next"></script>
<script>
  const XButton = {
    props: ['type'],
    template: `<button :class="'btn-'+type">
      <slot>ç¡®å®š</slot>
    </button>`
  }
  Vue.createApp({
    components: { XButton },
  }).mount('#app')
</script>
<style>
  .btn-big {
    padding: 8px 16px;
  }
  .btn-small {
    padding: 2px 4px;
  }
</style>
```

å…·åæ’æ§½ï¼šç»™æ’æ§½èµ·åå­—ï¼Œçˆ¶ç»„ä»¶ä¼ çš„æ—¶å€™åŠ ä¸Šæ ‡è¯†ï¼ˆ`v-slot:xxx`ã€ç®€å†™ `#xxx`ï¼‰

```html
<div id="app">
  <layout>
    <template v-slot:header>
      <h1>é¡µé¢header</h1>
    </template>
    <template #default>
      <p>é¡µé¢content</p>
    </template>
    <template #footer>
      <div>é¡µé¢footer</div>
    </template>
  </layout>
</div>
<script src="https://unpkg.com/vue@next"></script>
<script>
  const Layout = {
    template: `<div class="container">
      <header> <slot name="header"></slot> </header>
      <main> <slot></slot></main>
      <footer><slot name="footer"></slot></footer>
    </div>`
  }
  Vue.createApp({
    components: { Layout },
  }).mount('#app')
</script>
```

ä½œç”¨åŸŸæ’æ§½ï¼šå­ç»„ä»¶çš„ slot ä¸Šç»‘å®šï¼Œçˆ¶ç»„ä»¶ä¸Šä½¿ç”¨

```html
<div id="app">
  <news>ğŸ‘‰hello world</news>
  <news v-slot="props">ğŸ‘‰ {{props.item}}</news>
  <news v-slot="props">ğŸ‘‰ç¬¬{{props.index}}ç«  {{props.item}}</news>
  <news v-slot="{item, index}">âœ”ç¬¬{{index}}ç«  {{item}}</news>
  <!-- <news v-slot="{ item }">âœ” {{item}}</news>  -->
</div>
<script src="https://unpkg.com/vue@next"></script>
<script>
  const News = {
    data() { return { news: ['first news', 'second news'] } },
    template: `<ul>
      <li v-for="(item, index) in news">
        <slot :item="item" :index="index"></slot>  
      </li>
    </ul>`
  }
  Vue.createApp({
    components: { News },
  }).mount('#app')
</script>
```

## Provide & Inject çˆ·å­™æ•°æ®ä¼ å€¼

Provide Inject é€‚ç”¨ä¸æ·±åº¦åµŒå¥—çš„ç»„ä»¶ï¼Œçˆ¶ç»„ä»¶å¯ä»¥ä¸ºæ‰€æœ‰çš„å­ç»„ä»¶ç›´æ¥æä¾›æ•°æ®

![](https://cdn.wallleap.cn/img/pic/illustration/202308151606110.png)

```html
<div id="app">
  <toolbar></toolbar>
  <button @click="isDark=!isDark">åˆ‡æ¢</button>
</div>
<script src="https://unpkg.com/vue@next"></script>
<script>
  const ThemeButton = {
    inject: ['theme'],
    template: `
    <div :class="['button', theme.value]" ><slot></slot></div>
  `
  }
  const Toolbar = {
    components: { ThemeButton },
    inject: ['theme'],
    template: `<div :class="['toolbar', theme.value]">
      <theme-button>ç¡®å®š</theme-button>
    </div>`
  }

  Vue.createApp({
    data() {
      return { isDark: false }
    },
    //provide: { theme: 'dark'},
    // provide() {
    //   return { theme: this.isDark?'dark':'white' }
    // }, // ä¸Šé¢å¹¶ä¸æ˜¯å“åº”å¼çš„ï¼Œä½†æ˜¯ theme å°±æ˜¯å€¼ï¼Œç›´æ¥ç”¨ theme å°±è¡Œï¼Œä¸‹é¢æ˜¯å¯¹è±¡ï¼Œç”¨ theme.value
    provide() {
      return { theme: Vue.computed(()=>this.isDark?'dark':'white') }
    },
    components: { Toolbar },
  }).mount('#app')
</script>
<style>
  .toolbar {
    border: 1px solid #333;
    color: #333;
    padding: 10px;
  }

  .toolbar.dark {
    background: #333;
    color: #fff;
  }

  .button {
    padding: 2px 4px;
    border-radius: 4px;
    border: 1px solid #ccc;
    display: inline-block;
  }

  .button.dark {
    background: #666;
    color: #fff;
  }
</style>
```

setup è¯­æ³•ç³–

```ts
// é¡¶å±‚ç»„ä»¶æä¾›
provide('key', é¡¶å±‚ç»„ä»¶ä¸­çš„æ•°æ®)

// åº•å±‚ç»„ä»¶è·å–
const msg = inject('key)
```

## åŠ¨æ€ç»„ä»¶ä¸ keep-alive

åŠ¨æ€ç»„ä»¶ï¼šå½“å‰ä¸ç¡®å®šï¼Œå…±ç”¨ä¸€ä¸ªç»„ä»¶

```html
<div id="app">
  <button v-for="tab in tabs" :key="tab" :class="{ active: currentTab === tab }"
    @click="currentTab = tab">
    {{ tab }}
  </button>
  <!-- åŠ¨æ€ç»„ä»¶ -->
  <component :is="currentTab" class="tab"></component>
</div>
<script src="https://unpkg.com/vue@next"></script>
<script>
  const app = Vue.createApp({
    data() {
      return {
        currentTab: 'Tab1',
        tabs: ['Tab1', 'Tab2']
      }
    },
  })
  app.component('Tab1', {
    template: `<div>Tab1 content</div>`,
    created() { console.log('tab1 created') }
  })
  app.component('Tab2', {
    template: `<div>
      <input v-model="value" /> {{value}}
    </div>`,
    data() { return { value: 'hello' } },
    created() { console.log('tab2 created') }
  })
  app.mount('#app')
</script>
<style>
  .active { background: #e0e0e0; }
</style>
```

ä½¿ç”¨ keep-alive åŒ…è£¹åä¼šç¼“å­˜ï¼Œå°±ä¸ä¼šå†æ¬¡åˆ›å»ºäº†

- ç»„ä»¶ç¬¬ä¸€æ¬¡è¿›å…¥ï¼Œé’©å­çš„è§¦å‘ created â†’ mounted â†’ activated
- é€€å‡ºæ—¶è§¦å‘ deactivated
- å†æ¬¡è¿›å…¥æ—¶åªè§¦å‘ activated

```html
<div id="app">
  <button v-for="tab in tabs" :key="tab" :class="{ active: currentTab === tab }"
    @click="currentTab = tab">
    {{ tab }}
  </button>
  <keep-alive>
    <component :is="currentTab" class="tab"></component>
  </keep-alive>
</div>
<script src="https://unpkg.com/vue@next"></script>
<script>
  const app = Vue.createApp({
    data() {
      return {
        currentTab: 'Tab1',
        tabs: ['Tab1', 'Tab2']
      }
    },
  })
  app.component('Tab1', {
    template: `<div>Tab1 content</div>`,
    created() { console.log('tab1 created') },
    activated() { console.log('tab1 activated') }
  })
  app.component('Tab2', {
    template: `<div>
      <input v-model="value" /> {{value}}
    </div>`,
    data() { return { value: 'hello' } },
    created() { console.log('tab2 created') },
    activated() { console.log('tab2 activated') }
  })
  app.mount('#app')
</script>
<style>
  .active { background: #e0e0e0; }
</style>
```

## é€šè¿‡ ref è·å–çœŸå®çš„ DOM å¯¹è±¡æˆ–è€…ç»„ä»¶å®ä¾‹å¯¹è±¡

```vue
<script setup>
import { onMounted, ref } from 'vue'
import Child from './child.vue'
const titleRef = ref(null) // å˜é‡åå’Œä¸‹é¢çš„ ref å±æ€§å€¼ç›¸åŒï¼Œåœ¨è¿™é‡Œå®šä¹‰ï¼Œä½†ä½¿ç”¨éœ€è¦åœ¨ onMounted ä¸­ï¼ˆç­‰å¾… DOM å…ƒç´ åŠ è½½å®Œï¼‰
onMounted(() => {
  console.log(titleRef.value)
})
</script>
<template>
  <h1 ref="titleRef">æˆ‘æ˜¯æ ‡é¢˜</h1>
  <Child ref="comRef" />
</template>

<!-- å¦‚æœéœ€è¦æš´éœ²æ•°æ®ï¼Œå¯ä»¥åœ¨å­ç»„ä»¶ä¸­ä½¿ç”¨ define -->
const name = ref('test name')
defineExpose({
  name
})
```
